# トリガー仕様定義書

**作成日**: 2025-11-26
**バージョン**: 1.0
**対象**: Magic Spirit 全51種類のトリガー効果

---

## 目次

1. [トリガー仕様の読み方](#トリガー仕様の読み方)
2. [召喚時トリガー](#召喚時トリガー)
3. [破壊時トリガー](#破壊時トリガー)
4. [フェイズトリガー](#フェイズトリガー)
5. [攻撃関連トリガー](#攻撃関連トリガー)
6. [墓地発動トリガー](#墓地発動トリガー)
7. [常時効果](#常時効果)
8. [条件発動トリガー](#条件発動トリガー)
9. [その他のトリガー](#その他のトリガー)

---

## トリガー仕様の読み方

各トリガーは以下の形式で記載されています：

### テンプレート

**【トリガー名】**

- **トリガータイプ**: `TRIGGER_TYPE_CONSTANT`
- **使用頻度**: N回
- **優先度**: ★★★☆☆
- **発動タイミング**: 具体的なタイミングの説明
- **発動条件**: このトリガーが発火する条件
- **効果範囲**: 誰/何に影響するか
- **実装箇所**: magic-spirit.jsx内の関数名
- **注意点**: 実装時の注意事項

**使用例**:
```
C0000XXX: カード名
効果テキストの例
```

**実装パターン**:
```javascript
// コード例
```

---

## 召喚時トリガー

### 【召喚時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_SUMMON`
- **使用頻度**: 109回（最多）
- **優先度**: ★★★★★
- **発動タイミング**: モンスターが場に召喚された直後
- **発動条件**: カードが手札からフィールドに配置された時
- **効果範囲**: デッキ検索、墓地蘇生、ダメージ、ドローなど多様
- **実装箇所**: `summonCard()` 関数内
- **注意点**:
  - 召喚コスト支払い**後**に発動
  - 召喚されたモンスター自身の効果と、他のモンスターの「相手モンスター召喚時」を区別
  - 複数の【召喚時】効果がある場合は優先度順に処理

**使用例**:
```
C0000004: ゴミあさり粘液獣
【召喚時】墓地の《粘液獣》モンスター1体を攻撃力半減して場に戻す。

C0000008: 粘液獣・胞子
【召喚時】デッキから《粘液獣》と名の付くカード1枚を手札に加える。

C0000059: 光の騎士
【召喚時】デッキから《光の》魔法カード1枚を手札に加える。
```

**実装パターン**:
```javascript
// magic-spirit.jsx の summonCard() 内
const summonCard = (card, slotIndex) => {
  // 1. SPコスト支払い
  // 2. フィールドに配置
  // 3. 【召喚時】トリガー発火
  fireTrigger(TRIGGER_TYPES.ON_SUMMON, {
    card,
    slotIndex,
    currentPlayer,
    // ... context
  });
};

// cardEffects/primitive.js の例
C0000004: {
  [TRIGGER_TYPES.ON_SUMMON]: (context) => {
    const { addLog } = context;
    const success = reviveFromGraveyard(context, (card) => {
      return card.name && card.name.includes('粘液獣');
    }, true); // weakened = true

    if (success) {
      addLog('墓地の《粘液獣》を蘇生した！', 'info');
    }
    return success;
  },
},
```

---

### 【相手モンスター召喚時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_OPPONENT_SUMMON`
- **使用頻度**: 3回
- **優先度**: ★★☆☆☆
- **発動タイミング**: 相手プレイヤーがモンスターを召喚した直後
- **発動条件**: 相手のモンスター召喚時
- **効果範囲**: 相手モンスターへのダメージ、弱体化など
- **実装箇所**: `summonCard()` 関数内
- **注意点**: 自分のターンか相手のターンかを判定

**使用例**:
```
C0000058: 熾天使セラフ
【相手モンスター召喚時】対象モンスターに200ダメージを与える。

C0000124: シャドウ・エンパイア
【相手モンスター召喚時】その攻撃力を500ダウン、そのモンスターに300ダメージ。
```

**実装パターン**:
```javascript
// 相手ターンでの召喚時
fireTrigger(TRIGGER_TYPES.ON_OPPONENT_SUMMON, {
  summonedCard: card,
  summonedSlotIndex: slotIndex,
  currentPlayer,
  // ... context
});
```

---

### 【自分光属性モンスター召喚時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_SUMMON_LIGHT_SELF`
- **使用頻度**: 1回
- **優先度**: ★☆☆☆☆
- **発動タイミング**: 自分が光属性モンスターを召喚した時
- **発動条件**: 召喚されたモンスターの属性が「光」
- **効果範囲**: HPアップなど
- **実装箇所**: `summonCard()` 関数内
- **注意点**: 属性チェックが必要

**使用例**:
```
C0000091: 灯火の精霊
【常時】自分の光属性モンスターが召喚されるたび、そのモンスターのHPを200アップ。
```

---

## 破壊時トリガー

### 【自壊時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_DESTROY_SELF`
- **使用頻度**: 30回
- **優先度**: ★★★★☆
- **発動タイミング**: このカードが破壊された直後
- **発動条件**: 戦闘、効果、SPコスト不足などで破壊された時
- **効果範囲**: ダメージ、墓地蘇生、カードサーチなど
- **実装箇所**: カード破壊処理（複数箇所）
- **注意点**:
  - 破壊されたカードの情報を保持
  - 墓地送り**前**に発動
  - 場を離れる効果と区別

**使用例**:
```
C0000001: 粘液獣・開花
【自壊時】破壊された時一度だけ「粘液獣の種子（攻撃力0 HP100）」を場に生成する。

C0000025: ブレイズ・ドラゴン
【自壊時】デッキから［ドラゴン］モンスター1体を手札に加える。

C0000076: シャドウ・サーバント
【自壊時】デッキからコスト3以下「闇属性」魔法カード1枚を手札に加える。
```

**実装パターン**:
```javascript
// destroyMonster() または attack() 内
const destroyMonster = (context, targetIndex, isOpponent) => {
  const field = isOpponent ? context.p2Field : context.p1Field;
  const monster = field[targetIndex];

  if (!monster) return false;

  // 【自壊時】トリガー発火
  fireTrigger(TRIGGER_TYPES.ON_DESTROY_SELF, {
    destroyedCard: monster,
    slotIndex: targetIndex,
    isOpponent,
    // ... context
  });

  // 墓地に送る
  // ...
};
```

---

### 【自破壊時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_SELF_BREAK`
- **使用頻度**: 2回
- **優先度**: ★☆☆☆☆
- **発動タイミング**: 自壊時と同じ（用語の揺れ）
- **発動条件**: 【自壊時】と同様
- **効果範囲**: 【自壊時】と同様
- **実装箇所**: 【自壊時】と統合可能
- **注意点**: 【自壊時】と同じトリガータイプで処理

---

### 【［ドラゴン］モンスターが破壊された時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_DRAGON_DESTROYED`
- **使用頻度**: 1回
- **優先度**: ★☆☆☆☆
- **発動タイミング**: 自分の場のドラゴンモンスターが破壊された時
- **発動条件**: 破壊されたモンスターが［ドラゴン］カテゴリ
- **効果範囲**: 代わりのモンスター召喚など
- **実装箇所**: カード破壊処理
- **注意点**: カテゴリチェックが必要

**使用例**:
```
C0000038: 紅の竜宮
【［ドラゴン］モンスターが破壊された時】手札からそのコスト以下の別の［ドラゴン］モンスター1体を効果無効で場に戻す（1ターンに1度）。
```

---

### 【光属性モンスターが破壊される時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_LIGHT_BEFORE_DESTROY`
- **使用頻度**: 1回
- **優先度**: ★☆☆☆☆
- **発動タイミング**: 光属性モンスターが破壊される**直前**
- **発動条件**: 破壊されそうなモンスターが光属性
- **効果範囲**: 破壊の阻止、身代わり
- **実装箇所**: カード破壊処理の前
- **注意点**: 破壊を阻止できるため、破壊処理の前にチェック

**使用例**:
```
C0000072: ルミナスの聖域
【光属性モンスターが破壊される時】HPを1にして、代わりに自分のSPを1減らして守ることができる（1ターンに1度）。
```

---

## フェイズトリガー

### 【自分エンドフェイズ時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_END_PHASE_SELF`
- **使用頻度**: 40回
- **優先度**: ★★★★☆
- **発動タイミング**: 自分のターンのエンドフェイズ開始時
- **発動条件**: 現在のプレイヤーが自分
- **効果範囲**: ライフ回復、SP回復、ダメージ、墓地蘇生など
- **実装箇所**: `processPhase()` のエンドフェイズ（phase = 4）
- **注意点**:
  - 【エンドフェイズ時】と区別
  - 複数の効果がある場合は優先度順
  - ターン終了の直前

**使用例**:
```
C0000003: 粘液獣の群生地
【自分エンドフェイズ時】場にいる粘液獣1体につき相手プレイヤーに300ダメージを与える。

C0000019: 粘液の巣窟
【自分エンドフェイズ時】墓地の《粘液獣》1体を場に戻す。
【自分エンドフェイズ時】場に《粘液獣》が3体以上いる場合、自分のライフを500回復。

C0000053: 母なる大海
【自分エンドフェイズ時】自分のレスト状態のSPトークンを1つアクティブにする。
```

**実装パターン**:
```javascript
// processPhase() 内、エンドフェイズ処理
const processEndPhase = () => {
  // 【自分エンドフェイズ時】トリガー発火
  fireTrigger(TRIGGER_TYPES.ON_END_PHASE_SELF, {
    currentPlayer,
    phase,
    // ... context
  });

  // ターン切り替え
  nextTurn();
};
```

---

### 【エンドフェイズ時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_END_PHASE`
- **使用頻度**: 17回
- **優先度**: ★★★☆☆
- **発動タイミング**: 毎ターンのエンドフェイズ開始時（自分・相手問わず）
- **発動条件**: エンドフェイズに到達
- **効果範囲**: 攻撃力ダウン、ダメージなど
- **実装箇所**: `processPhase()` のエンドフェイズ
- **注意点**: 【自分エンドフェイズ時】より後に発動

**使用例**:
```
C0000056: 輝聖女ルミナス
【エンドフェイズ時】相手のモンスターの攻撃力を200ダウン。

C0000055: 深淵の潮流
【エンドフェイズ時】場に水属性モンスターが3体以上いる場合、相手プレイヤーに500ダメージを与える。
```

---

### 【相手エンドフェイズ時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_OPPONENT_END_PHASE`
- **使用頻度**: 2回
- **優先度**: ★★☆☆☆
- **発動タイミング**: 相手のターンのエンドフェイズ開始時
- **発動条件**: 現在のプレイヤーが相手
- **効果範囲**: 手札破棄、ダメージなど
- **実装箇所**: `processPhase()` のエンドフェイズ
- **注意点**: currentPlayerの判定が必要

**使用例**:
```
C0000089: 闇の宮殿
【相手エンドフェイズ時】自分の場に闇属性モンスターがいるとき、相手の手札を1枚ランダムに墓地に捨てる。
```

---

### 【自分メインフェイズ時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_MAIN_PHASE_SELF`
- **使用頻度**: 2回
- **優先度**: ★★☆☆☆
- **発動タイミング**: 自分のターンのメインフェイズ開始時
- **発動条件**: 現在のプレイヤーが自分、フェイズ=2（メイン）
- **効果範囲**: モンスター捕食、特殊召喚など
- **実装箇所**: `processPhase()` のメインフェイズ
- **注意点**: 1ターンに1度制限がある場合が多い

**使用例**:
```
C0000005: 苗床粘液獣
【自分メインフェイズ時】、1ターンに1度、場に粘液獣が3体以上いる場合、相手モンスター1体を捕食して自身の攻撃力をアップ（捕食1体につき300、最大1500まで）。
```

---

### 【自分メインフェイズ時、墓地で発動】

- **トリガータイプ**: `TRIGGER_TYPES.ON_MAIN_PHASE_FROM_GRAVEYARD`
- **使用頻度**: 2回
- **優先度**: ★★☆☆☆
- **発動タイミング**: 自分のメインフェイズ開始時、カードが墓地にある場合
- **発動条件**: カードが墓地に存在、SPコスト支払い可能
- **効果範囲**: 自己蘇生
- **実装箇所**: `processPhase()` のメインフェイズ、墓地チェック
- **注意点**: SPコストの支払いが必要

**使用例**:
```
C0000043: 深海のクラーケン
【自分メインフェイズ時、墓地で発動】SPコスト4を払い、このカードを場に戻すことができる。

C0000189: 旅の助っ人
【自分メインフェイズ時、墓地で発動】このカードを除外して、レスト状態のSPトークンを１つアクティブにする。
```

---

### 【自分エンドフェイズ時、墓地で発動】

- **トリガータイプ**: `TRIGGER_TYPES.ON_END_PHASE_FROM_GRAVEYARD`
- **使用頻度**: 2回
- **優先度**: ★★☆☆☆
- **発動タイミング**: 自分のエンドフェイズ、カードが墓地にある場合
- **発動条件**: カードが墓地に存在
- **効果範囲**: SP回復
- **実装箇所**: `processPhase()` のエンドフェイズ、墓地チェック
- **注意点**: 墓地から効果を発動

**使用例**:
```
C0000045: 海流の守護者
【自分エンドフェイズ時、墓地で発動】レスト状態のSPトークンを１つアクティブにする。

C0000143: 氷猫の使い魔
【自分エンドフェイズ時、墓地で発動】墓地の《ブリザードキャット》モンスター1体を手札に戻す（1度だけ）。
```

---

### 【バトルフェイズ開始時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_BATTLE_PHASE_START`
- **使用頻度**: 1回
- **優先度**: ★★☆☆☆
- **発動タイミング**: バトルフェイズ開始直後
- **発動条件**: フェイズ=3（バトル）に移行
- **効果範囲**: ダメージ
- **実装箇所**: `processPhase()` のバトルフェイズ
- **注意点**: バトル開始前に発動

**使用例**:
```
C0000023: レッドバーストドラゴン
【バトルフェイズ開始時】相手プレイヤーに300ダメージ（覚醒後500ダメージ）を与える。
```

---

### 【自分ターン開始時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_TURN_START_SELF`
- **使用頻度**: 2回
- **優先度**: ★★☆☆☆
- **発動タイミング**: 自分のターン開始フェイズ
- **発動条件**: ターン開始時
- **効果範囲**: カウンター増加など
- **実装箇所**: `processPhase()` のターン開始（phase = 0）
- **注意点**: ドローフェイズより前

**使用例**:
```
C0000410: 峠の暴君ヴェルミグノス
【自分ターン開始フェイズ時】このモンスターにチャージカウンターを1つ置く。
```

---

### 【自分ドローフェイズ】

- **トリガータイプ**: `TRIGGER_TYPES.ON_DRAW_PHASE_SELF`
- **使用頻度**: 1回
- **優先度**: ★☆☆☆☆
- **発動タイミング**: ドローフェイズ開始時
- **発動条件**: フェイズ=1（ドロー）
- **効果範囲**: ドロー追加など
- **実装箇所**: `processPhase()` のドローフェイズ
- **注意点**: 通常ドローの前後を明確化

---

## 攻撃関連トリガー

### 【自攻撃時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_ATTACK_SELF`
- **使用頻度**: 13回
- **優先度**: ★★★☆☆
- **発動タイミング**: このモンスターが攻撃を開始する時
- **発動条件**: 攻撃宣言時
- **効果範囲**: ダメージ、ライフ回復、相手弱体化など
- **実装箇所**: `attack()` 関数、ダメージ計算前
- **注意点**:
  - 【自攻撃前】と同じタイミング
  - 攻撃対象決定後、ダメージ計算前

**使用例**:
```
C0000061: 輝くユニコーン
【自攻撃時】自分のライフを500回復。

C0000095: シャドウ・プランダラー
【自攻撃時】相手の墓地のカード1枚を除外し、そのコスト＊100分のダメージを相手プレイヤーに与える。

C0000166: 岩狸・地割れ狸
【自攻撃時】相手の場にいるモンスター1体の効果をターン終了時まで無効化。
```

**実装パターン**:
```javascript
// attack() 関数内
const attack = (attackerIndex, targetIndex) => {
  const attacker = currentField[attackerIndex];

  // 【自攻撃時】トリガー発火
  fireTrigger(TRIGGER_TYPES.ON_ATTACK_SELF, {
    attacker,
    attackerIndex,
    targetIndex,
    // ... context
  });

  // ダメージ計算
  // ...
};
```

---

### 【自攻撃前】

- **トリガータイプ**: `TRIGGER_TYPES.ON_BEFORE_ATTACK_SELF`
- **使用頻度**: 1回
- **優先度**: ★☆☆☆☆
- **発動タイミング**: 【自攻撃時】と同じ（用語の揺れ）
- **発動条件**: 攻撃宣言時
- **効果範囲**: 攻撃力ダウンなど
- **実装箇所**: `attack()` 関数、ダメージ計算前
- **注意点**: 【自攻撃時】と統合可能

**使用例**:
```
C0000026: インフェルノ・ドラゴン
【自攻撃前】攻撃対象モンスターの攻撃力を300ダウン。
```

---

### 【自攻撃後】

- **トリガータイプ**: `TRIGGER_TYPES.ON_ATTACK_AFTER_SELF`
- **使用頻度**: 5回
- **優先度**: ★★☆☆☆
- **発動タイミング**: 攻撃処理（ダメージ計算）完了後
- **発動条件**: 攻撃が実行された後
- **効果範囲**: 追加ダメージ、ライフ減少、追加攻撃など
- **実装箇所**: `attack()` 関数、ダメージ計算後
- **注意点**:
  - 攻撃成功・失敗に関わらず発動
  - モンスター破壊時の追加効果あり

**使用例**:
```
C0000026: インフェルノ・ドラゴン
【自攻撃後】相手モンスターを破壊した場合、相手プレイヤーに500ダメージを与える。

C0000030: バースト・ドラゴン・ナイト
【自攻撃後】このカードが［ドラゴン］モンスターを破壊した場合、もう一度攻撃が可能。

C0000081: 虚蝕獣・喰らい触手
【自攻撃後】相手モンスターを破壊した場合、破壊したモンスターの攻撃力の50％分のライフを回復する。
```

**実装パターン**:
```javascript
// attack() 関数内
const attack = (attackerIndex, targetIndex) => {
  // ダメージ計算
  // ...

  // モンスター破壊判定
  const targetDestroyed = target.currentHp <= 0;

  // 【自攻撃後】トリガー発火
  fireTrigger(TRIGGER_TYPES.ON_ATTACK_AFTER_SELF, {
    attacker,
    attackerIndex,
    target,
    targetIndex,
    targetDestroyed,
    // ... context
  });
};
```

---

### 【相手モンスター攻撃時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_OPPONENT_MONSTER_ATTACK`
- **使用頻度**: 5回
- **優先度**: ★★☆☆☆
- **発動タイミング**: 相手のモンスターが攻撃を開始する時
- **発動条件**: 相手の攻撃宣言時
- **効果範囲**: 相手モンスターの弱体化、ダメージ
- **実装箇所**: `attack()` 関数、相手ターンの攻撃時
- **注意点**: フィールドカードに多い

**使用例**:
```
C0000018: 粘液の沼地
【相手モンスター攻撃時】相手プレイヤーに200ダメージを与える。

C0000129: ゴシック・プリンセス
【相手モンスター攻撃時】その攻撃力を300ダウン、自分のライフを200回復。

C0000140: 鎖の迷宮
【相手モンスター攻撃時】、その攻撃力を次のターンのエンドフェイズ時まで500ダウン。
```

---

### 【被攻撃時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_BEING_ATTACKED`
- **使用頻度**: 3回
- **優先度**: ★★☆☆☆
- **発動タイミング**: このモンスターが攻撃対象にされた時
- **発動条件**: 相手から攻撃を受ける時
- **効果範囲**: 反撃ダメージ、弱体化など
- **実装箇所**: `attack()` 関数、対象選択後
- **注意点**: ダメージ計算前に発動

**使用例**:
```
C0000361: 虹羽密林のフェザートラップ
【被攻撃時】相手モンスター1体に800ダメージを与え、攻撃力を500ダウン。

C0000417: 棘の剛毛猪イノブリスト
【被攻撃時】攻撃してきたモンスターに600ダメージを与える。
```

---

### 【相手モンスターに攻撃された時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_ATTACKED_BY_MONSTER`
- **使用頻度**: 1回
- **優先度**: ★☆☆☆☆
- **発動タイミング**: 【被攻撃時】と同じ（用語の揺れ）
- **発動条件**: 相手から攻撃を受ける時
- **効果範囲**: 反撃ダメージ
- **実装箇所**: `attack()` 関数
- **注意点**: 【被攻撃時】と統合可能

**使用例**:
```
C0000191: 反撃の使者
【相手モンスターに攻撃された時】、戦闘終了後にその相手モンスターに1200ダメージを与える。
```

---

## 墓地発動トリガー

### 【墓地に送られたとき】

- **トリガータイプ**: `TRIGGER_TYPES.ON_SENT_TO_GRAVEYARD`
- **使用頻度**: 1回
- **優先度**: ★☆☆☆☆
- **発動タイミング**: このカードが墓地に送られた直後
- **発動条件**: デッキから墓地、手札から墓地など
- **効果範囲**: ドロー
- **実装箇所**: 墓地送り処理（複数箇所）
- **注意点**: 【自壊時】と区別（破壊以外でも発動）

**使用例**:
```
C0000205: 囁く賢者
【墓地に送られたとき】デッキから1枚ドローする。
```

---

## 常時効果

### 【常時】

- **トリガータイプ**: `TRIGGER_TYPES.CONTINUOUS`
- **使用頻度**: 58回
- **優先度**: ★★★★★
- **発動タイミング**: カードが場にある間、常に有効
- **発動条件**: カードがフィールドに存在
- **効果範囲**: 攻撃力/HPアップ、コスト軽減、効果無効化など
- **実装箇所**:
  - 攻撃力/HP計算時
  - コスト計算時
  - ダメージ計算時
  - など多岐にわたる
- **注意点**:
  - パフォーマンスに影響
  - キャッシュ機構の実装推奨
  - フィールド変更時に再計算

**使用例**:
```
C0000003: 粘液獣の群生地
【常時】自分の場の粘液獣モンスターの攻撃力を300アップ。

C0000007: 粘液獣・キング
【常時】場にいる粘液獣1体につき自身の攻撃力を1500アップ（自身は含めない）。

C0000024: 灯火の護衛霊
【常時】自分の光属性モンスターが受けるダメージを200軽減する（1ターンに1度）。

C0000028: 炎竜母フレイマ
【常時】自分の［ドラゴン］モンスターは効果でダメージを受けない。
```

**実装パターン**:
```javascript
// 攻撃力計算の例
const calculateTotalAttack = (monster, playerField) => {
  let totalAttack = monster.attack;

  // 【常時】効果を全て適用
  const continuousEffects = getActiveContinuousEffects(CONTINUOUS_EFFECT_TYPE.ATTACK_MODIFIER);

  continuousEffects.forEach(effect => {
    if (effect.condition(monster)) {
      totalAttack += effect.modifier;
    }
  });

  return totalAttack;
};
```

---

### 【常時・手札】

- **トリガータイプ**: `TRIGGER_TYPES.CONTINUOUS_IN_HAND`
- **使用頻度**: 1回
- **優先度**: ★☆☆☆☆
- **発動タイミング**: カードが手札にある間
- **発動条件**: 手札に存在
- **効果範囲**: 特殊な召喚条件など
- **実装箇所**: 召喚処理、特殊召喚チェック
- **注意点**: 手札から効果を発動する珍しいパターン

**使用例**:
```
C0000396: 呪骸王エリザルヴェドン
【常時・手札】自分のライフが2000以下の場合、このカードをコスト0で召喚できる。
```

---

## 条件発動トリガー

### 【自ライフ3000以下】

- **トリガータイプ**: `TRIGGER_TYPES.ON_LIFE_BELOW_3000`
- **使用頻度**: 1回
- **優先度**: ★☆☆☆☆
- **発動タイミング**: ライフが3000以下になった時、または3000以下の状態で
- **発動条件**: 自分のライフ ≤ 3000
- **効果範囲**: 墓地から蘇生
- **実装箇所**: ライフ変更時のチェック
- **注意点**: 閾値到達を監視

**使用例**:
```
C0000063: 聖獣フェニックス
【自ライフ3000以下】このカードが墓地にある場合、1度だけ場に戻る（攻撃力2000、HP1500）。
```

---

### 【自分のライフが回復したとき】

- **トリガータイプ**: `TRIGGER_TYPES.ON_LIFE_HEAL_SELF`
- **使用頻度**: 1回
- **優先度**: ★☆☆☆☆
- **発動タイミング**: 自分のライフが回復した直後
- **発動条件**: ライフ増加
- **効果範囲**: 追加回復、ドローなど
- **実装箇所**: ライフ回復処理
- **注意点**: 回復量を記録

**使用例**:
```
C0000285: 薬師の助手ミミカ
【自分のライフが回復したとき】回復した量の半分だけ追加で回復する（1ターンに1度）。
```

---

## その他のトリガー

### 【発動時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_ACTIVATE`
- **使用頻度**: 5回
- **優先度**: ★★☆☆☆
- **発動タイミング**: フィールドカードやフェーズカード発動時
- **発動条件**: カードが発動された時
- **効果範囲**: 初期効果の発動
- **実装箇所**: フィールドカード/フェーズカード発動処理
- **注意点**: フェーズカードの初期効果

**使用例**:
```
C0000230: 永遠の灯の祈り
【発動時】場にいる光属性モンスターに【魔障壁（相手の魔法の効果を受けない）】を付与。
```

---

### 【場を離れる時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_LEAVE_FIELD`
- **使用頻度**: 2回
- **優先度**: ★☆☆☆☆
- **発動タイミング**: カードが場を離れる直前
- **発動条件**: フィールドから手札/墓地/除外に移動
- **効果範囲**: カード回収など
- **実装箇所**: カード除去処理
- **注意点**: 破壊、バウンス、除外など全てに適用

**使用例**:
```
C0000340: 深海の支配者・ヴェルゼファール
【場を離れる時】自分の墓地の「未来属性」カード1枚をデッキに戻す。
```

---

### 【覚醒】【覚醒時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_AWAKEN`
- **使用頻度**: 2回（合計）
- **優先度**: ★☆☆☆☆
- **発動タイミング**: 特定条件で覚醒状態になった時
- **発動条件**: カード固有の覚醒条件
- **効果範囲**: 攻撃力アップ、効果強化
- **実装箇所**: 覚醒条件チェック処理
- **注意点**: 覚醒システムの実装が必要

**使用例**:
```
C0000023: レッドバーストドラゴン
【覚醒】（覚醒条件は未定義）
【覚醒時】攻撃力が1000アップ。
```

---

### 【相手が魔法カードを発動時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_OPPONENT_MAGIC_ACTIVATE`
- **使用頻度**: 2回
- **優先度**: ★☆☆☆☆
- **発動タイミング**: 相手が魔法カードを使用した時
- **発動条件**: 相手の魔法カード発動
- **効果範囲**: ダメージ
- **実装箇所**: 魔法カード発動処理
- **注意点**: 妨害効果の可能性

**使用例**:
```
C0000027: マグマ・ドラゴン
【相手が魔法カードを発動時】相手プレイヤーに200ダメージを与える。
```

---

### 【自分モンスター被ダメージ時】

- **トリガータイプ**: `TRIGGER_TYPES.ON_FRIENDLY_MONSTER_DAMAGED`
- **使用頻度**: 1回
- **優先度**: ★☆☆☆☆
- **発動タイミング**: 自分のモンスターがダメージを受けた時
- **発動条件**: 味方モンスターへのダメージ
- **効果範囲**: ダメージ肩代わり
- **実装箇所**: ダメージ処理
- **注意点**: ダメージリダイレクト

**使用例**:
```
C0000057: プリズム・ガーディアン
【自分モンスター被ダメージ時】1ターンに1度だけ、自分の光属性モンスターがダメージを受ける場合、代わりにこのカードが受ける。
```

---

## トリガー優先度ルール

複数のトリガーが同時に発火する場合の処理順序：

### 優先度レベル

1. **レベル0（最優先）**: 破壊阻止系（【破壊される時】など）
2. **レベル1**: 攻撃前効果（【自攻撃前】など）
3. **レベル2**: 通常トリガー（【召喚時】【自壊時】など）
4. **レベル3**: 攻撃後効果（【自攻撃後】など）
5. **レベル4**: 常時効果（計算時に適用）

### 同一レベル内の処理順序

1. ターンプレイヤーの効果が先
2. 登録順（フィールドスロット番号順）

---

## まとめ

この仕様書では、Magic Spiritの**51種類のトリガー効果**を7つのカテゴリに分類し、詳細な仕様を定義しました。

**実装優先順位**:
1. 【召喚時】（109回）
2. 【常時】（58回）
3. 【自分エンドフェイズ時】（40回）
4. 【自壊時】（30回）
5. その他のトリガー

次のステップは、`trigger-implementation-guide.md` で実装方法を詳しく解説します。

---

**関連ドキュメント**:
- `trigger-system-design.md` - システム設計
- `trigger-implementation-guide.md` - 実装ガイド（次に作成）
- `code-structure.md` - コード構造全体図
