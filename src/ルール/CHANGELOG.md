# Magic Spirit 開発履歴 (CHANGELOG)

最終更新日: 2025-11-28

---

## 2025-11-27 (Phase 8完了: AI対戦モード)

### AIプレイヤーシステム実装
- **AIシステム基盤**: `src/engine/ai/` (~1,246行)
  - 3段階の難易度AI: かんたん/ふつう/むずかしい
  - プレイヤーごとのAI/人間切り替え（P1/P2個別設定）
  - ストラテジーパターンによる拡張可能な設計
  - 特殊ケース対応: 手札選択、モンスターターゲット、墓地選択、デッキ確認、チェーン確認
  - AI vs AI 自動対戦可能
- **設計書**: `src/ルール/ai-player-system-design.md`

### 状態異常システム実装
- **状態異常エンジン**: `src/engine/statusEffects/` (~580行)
  - 13種類の状態異常タイプ（眠り、凍結、雷撃、濡れ、守護、毒など）
  - ゲーム統合（ターン開始/エンドフェイズ処理、攻撃/技制限）
  - 状態異常付与ヘルパー4種 (`effectHelpers.js`)
  - UI実装（`FieldMonster.jsx` - 状態異常アイコン表示）
- 氷眠の檻デッキ追加、凍結/眠り付与カード6枚実装

### キーワード能力システム - 【刹那詠唱】
- `keywordAbilities/index.js`: キーワード能力基盤
- チェーンポイントシステム（バトル開始・攻撃宣言時に発動確認）
- チェーン確認ダイアログUI
- コスト計算: 通常コスト + 1 SP
- 公式ルール仕様書 ver2.3 に更新

### UI/UX改善
- 手札選択システム（ソラリア等の選択必須効果対応）
- コスト軽減表示（緑=軽減、赤=増加、ツールチップ対応）
- 墓地UI・墓地選択システム（閲覧、選択、トリガー発動）
- デッキトップ確認UI（`DeckReviewModal` - ドラッグ並び替え）
- ON_SUMMONトリガーのスコープ修正
- hasCategory()ヘルパー関数追加（カテゴリ比較を【】付き/なし両方に対応）

### バグ修正
- ログ重複修正（setState callback内のaddLog呼び出し）
- モンスター墓地送り修正（魔法・技ダメージでHP0時）
- フィールドカード上書き修正（既存カードを墓地に送る）
- ゲームログ保持量拡張

---

## 2025-11-26 (Phase 5-7完了: 効果システム大幅拡張)

### Phase 7: 常時効果システム完全実装
- **常時効果エンジン**: `src/engine/continuousEffects/` (~2,736行)
  - 12種類の効果タイプ（ATK_MODIFIER, HP_MODIFIER, DAMAGE_REDUCTION等）
  - 45枚のカード（フィールド23枚＋モンスター22枚）の常時効果実装
  - 条件チェックシステム（属性、カテゴリ、名前、ライフ等）
  - 値計算システム（固定値、数量×基本値、条件付き値）
- **設計書**: `src/ルール/continuous-effect-system-design.md`

### Phase 6.5: トリガーシステム完全実装
- **トリガーエンジン**: `triggerTypes.js` (372行), `triggerEngine.js` (716行)
  - 27種類の汎用トリガータイプ
  - 自動/任意発動の区別、優先度システム
- **カード固有トリガー**: `cardTriggers/` (~7,955行, 220+カード)
  - 炎属性33枚、水属性37枚、光属性47枚、闇属性45枚
  - 未来属性13枚、原始属性28枚、なし属性18枚
- **ドキュメント**: 4ファイル (~3,579行)

### Phase 5: フェイズカードUI実装
- フィールドカードとフェイズカードの分離、横並び配置
- 段階進行ロジック（CSVテキストパース方式）
- 情報パネルに現在/次の段階効果を表示
- フェイズカードでフェイズカードをチャージ可能

### カード固有エフェクトシステム
- `src/engine/effectHelpers.js`: 9つの再利用可能ヘルパー関数
- `src/engine/cardEffects/`: 108+カードの固有エフェクト実装
  - 属性別に整理（fire, water, light, dark, primitive, future, neutral）

### コードリファクタリング (Phase 1-4)
- magic-spirit.jsx: 2237行 → 1366行（-871行、39%削減）
- 新規ファイル作成: 9個
  - utils/: constants.js, helpers.js, cardManager.js
  - components/: Card.jsx, FieldMonster.jsx, SPTokens.jsx, GameLog.jsx
  - styles/: gameStyles.js
  - engine/: effectEngine.js

### UI/UX改善
- 魔法カード専用発動ボタン追加
- カード情報表示バグ修正（両プレイヤーエリアに表示される問題）
- 魔法カード発動のUX改善（フェーズ遷移と分離）
- デッキ選択機能（タイトル画面でプリセットデッキ選択）

---

## 2025-11-25以前 (Phase 1-3完了: 基盤構築)

### Phase 3: 技システム実装
- チャージシステム（属性カードを重ねる、最大2枚）
- 基本技（1枚チャージ）、上級技（2枚チャージ）発動
- 同属性チェック、「任意」指定の全属性対応
- 技効果パーサー・実行エンジン

### Phase 2: カードデータ完全実装
- CSVパーサー実装（433枚のカードデータ読み込み）
- カードデータ構造拡張（キーワード能力、カテゴリ配列化、禁忌フラグ）
- カード種類対応（monster, magic, field, phase）

### Phase 1: プロトタイプ
- 基本ルール実装（LP 6000、SP管理、5フェイズターン）
- カードシステム（モンスター召喚、魔法発動、フィールド設置）
- バトルシステム（攻撃、反撃30%、ダイレクトアタック）
- UI/UX（2人対戦画面、カード選択、HPバー、ゲームログ）

---

## コード統計サマリー

| カテゴリ | ファイル/実装数 |
|---------|----------------|
| カード固有エフェクト | 108+カード / 433 (25%) |
| カード固有トリガー | 220+カード / 433 (51%) |
| 常時効果カード | 45枚 (フィールド23+モンスター22) |
| 状態異常タイプ | 13種類 |
| トリガータイプ | 27種類 |
| 常時効果タイプ | 12種類 |
| AIシステム | ~1,246行 |
| トリガーシステム | ~8,671行 |
| 常時効果システム | ~2,736行 |
| 状態異常システム | ~580行 |

---

## マイルストーン

- **2025-11-27**: Phase 8 (AI対戦モード) 完了、総合進捗90%到達
- **2025-11-26 深夜**: Phase 7 (常時効果システム) 完了
- **2025-11-26 夜**: Phase 6.5 (トリガーシステム) 完了
- **2025-11-26 夕方**: Phase 5 (フェイズカードUI) 完了
- **2025-11-26 午後**: カード固有エフェクト108+実装完了
- **2025-11-26 午前**: Phase 1-4リファクタリング完了（39%コード削減）
