================================================================================
マジックスピリット カードゲーム 開発ロードマップ（進捗更新版）
================================================================================
最終更新日: 2025-11-28（ドキュメント整備）⭐⭐⭐⭐⭐⭐⭐
現在のステータス: Phase 2 完了 / Phase 3 大幅拡張 / Phase 4（キーワード能力・状態異常）75%完了 ⭐⭐⭐ / Phase 5（カード固有エフェクト）完了 / Phase 5（フェイズカード）実装完了 ⭐ / Phase 6（エフェクトエンジン）完了 / Phase 6.5（トリガーシステム）完了 ⭐⭐⭐ / Phase 7（常時効果システム）完了 ⭐⭐⭐⭐ / Phase 8（AI対戦モード）完了 ⭐⭐⭐⭐⭐ / Phase 10（UI）大幅進展 / コードリファクタリング完了
総合進捗率: 90%（+3%）

進捗凡例:
✅ 完了
🚧 実装中
📋 未着手
⚠️ 要改善

================================================================================
【完了済み】Phase 1: プロトタイプ
================================================================================
✅ 基本ルール実装
   ✅ ライフポイント 6000
   ✅ SPトークン管理（最大10、アクティブ/レスト状態）
   ✅ 5フェイズターン進行（ターン開始→ドロー→メイン→バトル→エンド）
   ✅ 先攻1ターン目の攻撃制限

✅ カードシステム
   ✅ モンスター召喚（コスト支払い）
   ✅ 魔法カード発動
   ✅ フィールドカード設置
   ✅ 30種類のサンプルカード実装

✅ バトルシステム
   ✅ モンスター攻撃
   ✅ 反撃ダメージ（攻撃力の30%）
   ✅ ダイレクトアタック
   ✅ ダメージ軽減（モンスター存在時50%、フィールドカード存在時75%）

✅ UI/UX
   ✅ 2人対戦画面
   ✅ カード選択・効果表示
   ✅ HPバー、SPトークン表示
   ✅ ゲームログ
   ✅ フェイズ進行表示
   ✅ 選択カード詳細表示パネル
   ✅ 攻撃可能インジケーター
   ✅ チャージ数表示

================================================================================
【完了】Phase 2: カードデータ完全実装
================================================================================
優先度: ★★★（高）
目的: 全433枚のカードを使用可能にする

✅ 2-1. CSVパーサーの実装
   ✅ /mnt/project/cardlist.csv を読み込み
   ✅ カードID、名称、属性、コスト、種類、キーワード能力、攻撃力、HP、
     カテゴリ、効果、フレーバーテキストをパース
   ✅ 複数行にまたがる効果テキストの対応（引用符内改行の処理）
   ✅ エスケープされた引用符の処理

✅ 2-2. カードデータ構造の拡張
   ✅ キーワード能力フィールドの追加（配列形式）
   ✅ カテゴリ（【ドラゴン】【スライム】等）の配列化
   ✅ 禁忌カードフラグの追加
   ✅ 技情報の抽出（基本技・上級技）

✅ 2-3. カード種類の完全対応
   ✅ monster（モンスター）
   ✅ magic（魔法）
   ✅ field（フィールド）
   🚧 phase（フェイズカード）← データ構造は対応済み、ゲームロジック未実装

✅ 2-4. CSVファイルの非同期読み込み
   ✅ /cardlist/cardlist.csv からの読み込み
   ✅ エラーハンドリング（サンプルカードへのフォールバック）
   ✅ ローディング状態の表示

進捗率: 95% ✅
備考: CSVパーサーは完全に実装され、433枚のカードが読み込み可能。
      フェイズカードのゲームロジックのみ未実装。

================================================================================
【大幅拡張】Phase 3: 技システム実装
================================================================================
優先度: ★★★（高）
目的: チャージによる基本技・上級技を実装

✅ 3-1. チャージシステム
   ✅ 属性カードをモンスターに重ねる機能
   ✅ 1モンスターにつき最大2枚チャージ
   ✅ 1ターンに1回のチャージ制限（プレイヤー全体）
   ✅ 属性チャージ vs SPチャージの選択
   ✅ チャージカードが場に残る仕様

✅ 3-2. 基本技の実装
   ✅ 1枚チャージで発動
   ✅ 同属性カードのみ発動可能のチェック
   ✅ 「任意」指定の場合は全属性対応
   ✅ 技発動後もチャージカードは場に残る
   ✅ 技効果の実行エンジン（effectEngine.js）

✅ 3-3. 上級技の実装
   ✅ 2枚チャージで発動
   ✅ 強力な効果の実装
   ✅ チャージ枚数チェック
   ✅ カード固有エフェクト対応

✅ 3-4. 技効果のパーサー・実行エンジン
   ✅ 効果テキストから技を抽出
   ✅ 「基本技：」「上級技：」「【召喚時】」のパターンマッチ
   ✅ ジェネリック効果エンジン（13種類の効果タイプ）
   ✅ カード固有エフェクトシステム（108+カード実装済み）
   ✅ エフェクトヘルパーライブラリ（9つの再利用可能関数）
   ✅ ハイブリッドアプローチ（ジェネリック + カード固有）

進捗率: 85% ✅
備考: 技システムの基盤が完成し、108+カードのカード固有エフェクトが実装済み。
      残り325カード（433 - 108）のエフェクト実装が今後の課題。

現在の実装状況:
- チャージ機能: 動作確認済み
- 基本技・上級技の発動UI: 実装済み
- 技効果の実行: ジェネリック + カード固有の両方に対応
- 属性チェック: 実装済み
- チャージ枚数チェック: 実装済み
- effectEngine.js: 220行のジェネリックエフェクトエンジン
- effectHelpers.js: 446行のエフェクトヘルパー関数
- cardEffects/: ~1695行のカード固有エフェクト実装

実装済みの技効果:
✅ ダメージ（単体/全体/条件付き）
✅ 回復（HP/ライフ）
✅ バフ/デバフ（攻撃力/HP増減）
✅ サーチ（デッキから手札へ）
✅ 蘇生（墓地から場へ、弱体化対応）
✅ 破壊（モンスター指定破壊）
✅ ドロー効果
✅ デッキミル（自分/相手）
✅ 墓地・フィールド操作

今後実装予定の技効果:
📋 SPトークン操作（高度な効果）
📋 コントロール奪取（高度な効果）
📋 永続効果の実装
📋 複雑な条件分岐効果

================================================================================
【実装中】Phase 4: キーワード能力実装 ⭐
================================================================================
優先度: ★★☆（中）
目的: 特殊能力を持つカードの差別化

✅ 4-0. キーワード能力システム基盤 ⭐⭐ NEW (2025-11-27)
   ✅ keywordAbilities/index.js 作成
   ✅ KEYWORD_ABILITIES: 14種類のキーワード能力定義
   ✅ hasKeyword(), getCardKeywords(): 判定関数
   ✅ ハイブリッドアーキテクチャ設計（既存システムとの連携）
   ✅ 詳細ドキュメント作成（keyword-abilities.md）

✅ 4-1. 【刹那詠唱】実装完了 ⭐⭐ NEW (2025-11-27)
   ✅ isSetsunaMagic(), getSetsunaCost(): 判定・コスト計算
   ✅ getActivatableSetsunaMagics(): 発動可能カード取得
   ✅ チェーンポイントシステム実装
     ✅ CHAIN_POINTS: バトルフェイズ開始時、攻撃宣言時
     ✅ createStackItem(), resolveStack(): スタック構造（Phase B準備）
   ✅ チェーン確認ダイアログUI
   ✅ 非アクティブプレイヤーへの発動確認
   ✅ コスト: 通常コスト + 1 SP
   ✅ Phase A実装: 1チェーン（相互チェーン不可）
   ✅ 公式ルール仕様書更新（ver2.3）
   ✅ チェーンシステム設計書（chain-system-design.md）

📋 4-2. 残りのキーワード能力
   ✅ データ構造には対応済み（keywordフィールド）
   📋 【覚醒】: 条件達成で攻撃力上昇 ← パースはされるが効果未実装
   📋 【死触】: ダメージを与えれば即破壊
   📋 【魔障壁】: 魔法耐性
   📋 【禁忌カード】: デッキに1枚制限検証
   📋 【毒侵】: 毒状態付与
   📋 【深蝕】: エンドフェイズ攻撃力減少
   📋 【変幻身】: 形態変化
   📋 【壮麗】: 同名カード捨てて効果発動
   📋 【魂結】: リンク効果
   📋 【犠現】: 生贄コスト軽減
   📋 【残魂】: 破壊時効果
   📋 【威圧吼】: 攻撃時追加効果
   📋 【未来予知】: デッキ操作

✅ 4-3. 状態異常システム ⭐⭐ NEW (2025-11-27)
   ✅ 状態異常エンジン（statusEffects/statusEngine.js - ~280行）
      - applyStatus, removeStatus, hasStatus, getActiveStatuses
      - canAttack, canUseSkill, canUseTrigger
      - getAttackModifier, getDamageMultiplier
      - processTurnStart, processEndPhase
      - calculateDamageReduction
   ✅ 状態異常タイプ定義（statusTypes.js - ~275行）
      - 13種類の状態異常タイプ定義
      - メタデータ（アイコン、色、効果、カテゴリ）
   ✅ ゲーム統合（magic-spirit.jsx）
      - プレイヤー状態異常ステート
      - ターン開始/エンドフェイズ処理
      - 攻撃/技制限チェック
      - ダメージ計算への統合
   ✅ 状態異常付与ヘルパー（effectHelpers.js）
      - selectAndApplyStatusToOpponent
      - applyStatusToOpponentMonster
      - applyStatusToAllOpponentMonsters
      - applyStatusToOwnMonster
   ✅ 実装済み状態異常:
      - 眠り (SLEEP): 行動不能、効果無効、50%で解除
      - 凍結 (FREEZE): 攻撃力半減、行動不能、50%で解除
      - 雷撃 (THUNDER): ATK-500、技不能
      - 濡れ (WET): 被ダメージ2倍
      - 行動不能 (STUN): 攻撃・効果不可
      - 効果無効 (SILENCE): 効果発動不可
      - 守護 (GUARD): ダメージ半減（1回）
      - 深蝕 (CORRODE): エンド時ATKダウン
      - 覚醒 (AWAKENED): ATK上昇
      - 毒 (POISON): プレイヤーに毎ターン100ダメージ
   🚧 カード実装進行中（6枚完了）:
      - C0000039 アクア・メイデン（眠り）
      - C0000144, C0000145 ブリザードキャット（凍結）
      - C0000150 氷の吐息（凍結）
      - C0000157, C0000199 全体凍結

✅ 4-4. 状態異常の表示 ⭐ NEW
   ✅ モンスターカードに状態アイコン表示（FieldMonster.jsx）
   ✅ ツールチップで状態異常名を表示
   ✅ ターン経過による自動解除（processTurnStart, processEndPhase）

進捗率: 75% 🚧
備考: 刹那詠唱・チェーンシステム完成、状態異常システム完成。残りのキーワード能力（【覚醒】【死触】【魔障壁】等）が今後の課題。

================================================================================
【実装完了】Phase 5: フェイズカード実装 ⭐
================================================================================
優先度: ★★☆（中）
目的: 段階的強化システムの実装

✅ 5-1. フェイズカードの基本
   ✅ データ構造対応（カードタイプ 'phasecard'）
   ✅ フィールドとは別の専用スロット
   ✅ フェイズカード情報パネル実装
   ✅ フィールドカードとフェイズカードの横並び配置
   ✅ 設置・発動機能の実装
   ✅ 初期効果 + 3段階の強化効果（CSVテキストパース方式）
   ✅ 同属性カードをチャージして段階進行

✅ 5-2. 段階効果の処理
   ✅ チャージごとに次の段階へ（stage 0→1→2→3）
   ✅ 効果は上書き（前の段階は無効）- UIで現在/次の効果を表示
   ✅ 最大3枚チャージ、1ターン1枚制限
   ✅ CSVのeffectフィールドから段階効果をパース
     （「初期効果:」「1枚重ね:」「2枚重ね:」「3枚重ね:」形式）

✅ 5-3. 最終フェイズ処理
   ✅ 3枚チャージ後、最終段階発動
   ✅ フェイズカードを墓地へ送る
   ✅ チャージしたカードも一緒に墓地へ

✅ 5-4. チャージ対象の拡張
   ✅ モンスター、魔法、フィールドカードでチャージ可能
   ✅ フェイズカードでフェイズカードをチャージ可能（同属性）

進捗率: 95% ✅
備考: 段階進行ロジック実装完了。CSVテキストパース方式により全フェイズカードに対応。
      効果の自動実行は一部トリガーシステムと連携が必要（ログ表示は実装済み）。

【2025-11-26実装内容】
✅ フィールドカードとフェイズカードの分離
✅ 横並び配置UI実装
✅ フィールド/フェイズカード情報パネル
✅ 設置・発動の基本機能
✅ 段階進行ロジック実装（CSVテキストパース方式）
✅ 情報パネルに現在の段階効果と次の段階効果を表示
✅ フェイズカードでフェイズカードをチャージ可能

================================================================================
【大幅拡張】Phase 6: 効果エンジン実装
================================================================================
優先度: ★★★（高）
目的: カード効果の自動処理

✅ 6-1. トリガー効果
   ✅ 召喚時効果【召喚時】の実装
   ✅ 基本技・上級技の実装
   📋 破壊時効果【破壊時】
   📋 バトルフェイズ開始時効果
   📋 ターン終了時効果

✅ 6-2. 効果の種類
   ✅ ダメージ（単体/全体/プレイヤー/条件付き）
   ✅ 回復（HP/ライフ）
   ✅ バフ/デバフ（攻撃力/HP増減）
   ✅ サーチ（デッキから手札へ）
   ✅ 蘇生（墓地から場へ、弱体化対応）
   ✅ 破壊（モンスター/カード）
   ✅ ドロー効果
   ✅ デッキミル（自分/相手）
   📋 コントロール奪取（未実装）
   📋 永続効果（未実装）

✅ 6-3. 効果テキストパーサー
   ✅ 正規表現による効果抽出
   ✅ 数値パラメータの取得
   ✅ ジェネリックパターンマッチング
   ✅ カード固有エフェクトへの委譲

✅ 6-4. カード固有エフェクトシステム（2025-11-26実装）
   ✅ ハイブリッドアプローチ（ジェネリック + カード固有）
   ✅ 効果ヘルパーライブラリ（effectHelpers.js）
      - millDeck, millOpponentDeck
      - conditionalDamage
      - searchCard
      - reviveFromGraveyard
      - destroyMonster
      - drawCards
      - healLife
      - modifyAttack, modifyHP
   ✅ カード固有エフェクト実装（cardEffects/）
      - 炎属性: fire.js
      - 水属性: water.js
      - 光属性: light.js
      - 闇属性: dark.js
      - 原始属性: primitive.js
      - 未来属性: future.js
      - なし属性: neutral.js
   ✅ エフェクトレジストリ（cardEffects/index.js）
   ✅ テンプレートファイル（_template.js）

進捗率: 80% ✅
備考: effectEngine.js（220行）、effectHelpers.js（446行）、
      cardEffects/（~1695行）で合計~2361行の効果システム実装。
      108+カードの固有エフェクト実装済み（433カード中）。
      残り325カードの実装と永続効果、コントロール奪取が今後の課題。

================================================================================
【完了】Phase 6.5: トリガーシステム実装 ⭐ NEW
================================================================================
優先度: ★★★（高）
目的: イベントベースのカード効果システムを実装
実装日: 2025-11-26

✅ 6.5-1. トリガータイプ定義システム
   ✅ 26種類の汎用トリガータイプ（triggerTypes.js - 302行）
      - 召喚時トリガー（5種類）: ON_SUMMON, ON_OPPONENT_SUMMON, etc.
      - 破壊時トリガー（5種類）: ON_DESTROY_SELF, ON_CATEGORY_MONSTER_DESTROYED, etc.
      - フェイズトリガー（6種類）: ON_TURN_START_SELF, ON_MAIN_PHASE_SELF, etc.
      - 攻撃関連（3種類）: ON_ATTACK, ON_ATTACKED, ON_ATTACK_SUCCESS
      - 墓地発動（2種類）: ON_MAIN_PHASE_FROM_GRAVEYARD, etc.
      - その他（5種類）: CONTINUOUS, ON_LIFE_CONDITION, etc.
   ✅ 発動タイプ: AUTOMATIC（自動・強制）/ OPTIONAL（任意発動）
   ✅ 優先度システム: HIGHEST, HIGH, NORMAL, LOW, LOWEST
   ✅ ヘルパー関数: isOptionalTrigger(), getTriggerCategory(), getTriggerDisplayName()

✅ 6.5-2. トリガーエンジン（triggerEngine.js - 658行）
   ✅ グローバルトリガーレジストリ（TriggerRegistryクラス）
      - register(), unregister(), get(), getByCardId(), clear()
   ✅ トリガー登録・解除システム
      - registerCardTriggers(): カード召喚時にトリガー登録
      - parseCardTriggers(): 効果テキストからトリガー抽出
      - unregisterCardTriggers(): カード破壊時にトリガー解除
   ✅ 自動発動トリガーの発火
      - fireTrigger(): 特定タイプの自動トリガーを一括発火
      - sortTriggersByPriority(): 優先度順にソート・実行
   ✅ 任意発動トリガーの取得
      - getCardMainPhaseTriggers(): フィールドカードのメインフェイズトリガー
      - getCardGraveyardTriggers(): 墓地カードのトリガー
      - activateTrigger(): プレイヤーが手動で発動
   ✅ ターン管理
      - resetTurnFlags(): ターン終了時に使用済みフラグをリセット
      - checkTriggerCondition(): トリガー条件チェック

✅ 6.5-3. カード固有トリガー実装（cardTriggers/ - 合計5030行、168枚） ⭐
   ✅ fireCards.js（炎属性 - 819行、33枚）
      - 炎属性モンスターのトリガー実装完了
      - 召喚時、破壊時、攻撃時、エンドフェイズ等の多様なトリガー
      - ドラゴンカテゴリ連携、炎属性シナジー
   ✅ waterCards.js（水属性 - 970行、34枚）
      - 水属性モンスターのトリガー実装完了
      - 回復、ドロー、デッキミル、バフ効果
      - 水属性特有の持久戦略
   ✅ lightCards.js（光属性 - 1309行、47枚） ⭐ 最多カード数
      - 光属性モンスターのトリガー実装完了
      - 回復、サーチ、蘇生、バフ効果
      - 天使、騎士カテゴリ連携
      - 47枚実装で最も充実した属性
   ✅ darkCards.js（闇属性 - 1428行、42枚）
      - 闇属性モンスターのトリガー実装完了
      - ダメージ、破壊、墓地操作、デッキミル
      - 闇属性特有の自己犠牲・墓地活用戦略
   ✅ futureCards.js（未来属性 - 504行、12枚）
      - 未来属性モンスターのトリガー実装完了
      - SP回復、時空操作、デッキ操作
      - 12枚のカード実装（テンプレート属性）
   ✅ effectHelpers.js を活用した統一実装
      - 再利用可能なヘルパー関数を活用
      - 条件関数による柔軟なトリガー発動
      - コード重複を最小化
   📋 原始属性・なし属性のトリガー実装（今後の課題）
      - primitiveCards.js（原始属性）
      - neutralCards.js（なし属性）

✅ 6.5-4. ゲームへの統合（magic-spirit.jsx）
   ✅ initGame(): clearAllTriggers() - システムリセット
   ✅ summonCard(): registerCardTriggers() - トリガー登録
   ✅ attack(): unregisterCardTriggers() + fireTrigger(ON_DESTROY_SELF) - 破壊時処理
   ✅ processPhase(): 各フェイズでfireTrigger() - フェイズトリガー発火
      - ターン開始: ON_TURN_START_SELF
      - ドロー: ON_DRAW_PHASE_SELF
      - バトル開始: ON_BATTLE_PHASE_START
      - エンド: ON_END_PHASE_SELF + resetTurnFlags()
   ✅ スキルパネルUI: getCardMainPhaseTriggers() - 任意発動トリガー表示
      - 基本技・上級技と同じUIエリアに統合
      - 🌟アイコン付きトリガーボタン
      - 使用済みの場合グレーアウト
      - 1ターン1度制限の管理

✅ 6.5-5. トリガーシステムの特徴
   ✅ カテゴリ/属性の汎用化
      - ハードコーディングなし、条件関数で柔軟に対応
      - 51種類の特定トリガー → 26種類の汎用トリガーに削減
   ✅ 自動 vs 任意の明確な区別
      - AUTOMATIC: 自動発火（召喚時、破壊時、フェイズ時など）
      - OPTIONAL: UIボタンで発動（メインフェイズ時など）
   ✅ カード紐づけ型UI
      - トリガーはカード選択時に表示（全体一覧ではない）
      - フィールドカード: 基本技/上級技と同じエリア
      - 墓地カード: 墓地UI実装予定（次の課題）
   ✅ 優先度制御
      - 複数トリガー同時発火時の順序制御
      - ターンプレイヤー優先
   ✅ 1ターン1度制限
      - usedThisTurnフラグで管理
      - エンドフェイズで自動リセット

✅ 6.5-6. トリガーシステムドキュメント（src/ルール/ - 合計3579行） ⭐ NEW
   ✅ trigger-implementation-guide.md（1268行）
      - ステップバイステップの実装ガイド
      - コード例とパターン集
      - ベストプラクティスと落とし穴
   ✅ trigger-specifications.md（941行）
      - 全26種類のトリガータイプ詳細仕様
      - 発動ルールと優先度
      - エッジケース処理
   ✅ trigger-revision-plan.md（823行）
      - システム設計の進化過程
      - リファクタリング決定事項
      - アーキテクチャ改善履歴
   ✅ trigger-system-design.md（547行）
      - ハイレベルアーキテクチャ
      - 設計原則
      - 統合パターン

進捗率: 95% ✅ ⭐
備考: トリガーシステムの基盤完成（~1230行）。
      168カード実装完了（~5030行）。
      残り265カード（433 - 168）のトリガー実装が今後の課題。
      墓地UIと常時効果システムが未実装。

コード統計:
- triggerTypes.js: 372行（トリガータイプ定義）
- triggerEngine.js: 660行（トリガー管理システム）
- cardTriggers/fireCards.js: 819行（炎属性33枚）
- cardTriggers/waterCards.js: 970行（水属性34枚）
- cardTriggers/lightCards.js: 1309行（光属性47枚） ⭐ 最多
- cardTriggers/darkCards.js: 1428行（闇属性42枚）
- cardTriggers/futureCards.js: 504行（未来属性12枚）
- magic-spirit.jsx: 345行追加（統合コード）
- 合計: ~6407行のトリガーシステム実装 + 3579行のドキュメント

次のステップ:
📋 原始・なし属性のトリガー実装（残り265カード）
📋 墓地UI実装（墓地トリガー用）
📋 カード選択UIの実装（時空旅人ソラリアなど）
📋 デッキ操作UIの実装（デッキトップ確認・並び替え）
📋 トリガーアニメーション・エフェクト

================================================================================
【完了】Phase 7: 常時効果システム実装 ⭐⭐⭐⭐ NEW
================================================================================
優先度: ★★★（高）
目的: 場にいる間継続的に適用される効果システムの実装
実装日: 2025-11-26

✅ 7-1. 常時効果タイプ定義システム
   ✅ 12種類の効果タイプ（effectTypes.js - 224行）
      - ATK_MODIFIER: 攻撃力修正
      - HP_MODIFIER: HP修正
      - DAMAGE_REDUCTION: ダメージ軽減
      - DAMAGE_IMMUNITY: ダメージ無効
      - DAMAGE_DEALT_MODIFIER: 与ダメージ修正
      - DAMAGE_RECEIVED_MODIFIER: 被ダメージ修正
      - SUMMON_COST_MODIFIER: 召喚コスト修正
      - MAGIC_COST_MODIFIER: 魔法コスト修正
      - ATTACK_RESTRICTION: 攻撃制限
      - SP_RESTRICTION: SP制限
      - MAGIC_NEGATION: 魔法無効化
      - SKILL_NEGATION: 技無効化
      - ON_SUMMON_BUFF: 召喚時バフ
   ✅ ターゲットタイプ（targetTypes.js - 182行）
      - SELF_CARD, SELF_MONSTERS, OPPONENT_MONSTERS, ALL_MONSTERS
      - SELF_SUMMON, OPPONENT_SUMMON, SELF_MAGIC, OPPONENT_MAGIC
   ✅ 値計算タイプ（valueCalculator.js - 216行）
      - FIXED: 固定値
      - COUNT_MULTIPLY: 数量×基本値
      - CONDITIONAL: 条件付き値
      - CUSTOM: カスタム計算

✅ 7-2. 条件チェックシステム（conditionChecker.js - 303行）
   ✅ 属性条件（attribute, attributes）
   ✅ カテゴリ条件（category, categories）
   ✅ 名前条件（nameIncludes, nameExact, hasNameOnField）
   ✅ コスト条件（maxCost, minCost）
   ✅ 場の状態条件（minFieldMonsters, minAttributeOnField, hasCategoryOnField）
   ✅ ライフ条件（maxLife, minLife）
   ✅ ターン条件（isMyTurn）
   ✅ 除外条件（excludeSelf）

✅ 7-3. 常時効果エンジン（effectEngine.js - 687行）
   ✅ ライフサイクル管理
      - register(): カード登録時に効果を有効化
      - unregister(): カード除去時に効果を解除
      - clear(): ゲームリセット時に全効果クリア
      - resetTurnFlags(): ターン終了時に使用フラグリセット
   ✅ ステータス修正計算
      - calculateAttackModifier(): 攻撃力修正値計算
      - calculateHPModifier(): HP修正値計算
   ✅ ダメージ関連計算
      - calculateDamageReduction(): ダメージ軽減値計算
      - calculateDamageDealtModifier(): 与ダメージ修正値計算
      - calculateDamageReceivedModifier(): 被ダメージ修正値計算
   ✅ コスト修正計算
      - calculateSummonCostModifier(): 召喚コスト修正
      - calculateMagicCostModifier(): 魔法コスト修正
   ✅ 制限チェック
      - canAttack(): 攻撃可能チェック
      - checkSPRestriction(): SP制限チェック
   ✅ 無効化チェック
      - tryNegateMagic(): 魔法無効化
      - tryNegateSkill(): 技無効化
   ✅ 召喚連動効果
      - getSummonBuffs(): 召喚時バフ取得
   ✅ フェイズカード対応
      - registerPhaseCard(): 段階別効果登録
      - updatePhaseCardStage(): 段階更新

✅ 7-4. カード効果定義（effectDefinitions/ - 1018行、45枚）⭐
   ✅ fieldCards.js（390行、23枚）
      - 原始属性: 粘液獣の群生地、粘液の沼地
      - 炎属性: ドラゴンの火山、炎の岩峰
      - 水属性: 母なる大海、深淵の潮流、氷猫の聖域、永遠の氷結宮殿、アクアレギアの廃墟
      - 光属性: クリスタルサンクチュアリ、輝く天蓋、フルーツ・マリオネット劇場、雷嵐の聖域、天翔峰アヴィクルス
      - 闇属性: 闇の宮殿、禁忌の王座、魔界の幼魔王城、呪縛の塔・ヴェルナクール
      - 未来属性: 時読みの塔、ヴォイドゲートの遺構
      - なし属性: 鉄槍騎士団の宿舎、ご主人様のアパート、薬師の隠れ家、虹羽の微脈
   ✅ monsterCards.js（368行、22枚）
      - 原始属性: 粘液獣・キング、禁忌のゴシッククラウン
      - 炎属性: 炎竜母フレイマ、クリムゾン・ワイバーン、岩狸・大岩王
      - 水属性: ブリザードマスターの愛猫・ミスティ、虹羽密林の湖鱗獣・アクアレオン、呪術狩りの鎖術師ミリア
      - 光属性: 灯火の護衛霊、灯火の精霊、撮影会のリリカ、フルーツ・マリオネット・メロン王、虹羽密林の金胞草・ファルネシア、輝鎖の聖姫ルミリア、呪術狩りの聖焔騎士レオノーラ
      - 闇属性: 闇魔界の貴婦人、闇の巨像、鎖縛の禁忌姫リアノン・エターナル、影羽の鳥民・ノクティス、魔女エリザヴェット・ヴェイル
      - なし属性: 団長プニリーヌ・ソフティア、鉄槍騎士団のウィア、鉄槍の騎士長、呪術狩りの傭兵バランド
   ✅ phaseCards.js（183行）
      - 段階別効果定義システム
      - フェイズカードの段階0-3に対応

✅ 7-5. ゲームへの統合（magic-spirit.jsx）
   ✅ initGame(): continuousEffectEngine.clear() - システムリセット
   ✅ summonCard(): continuousEffectEngine.register() - 効果登録
   ✅ summonCard(): getSummonBuffs() - 召喚時バフ適用
   ✅ attack(): calculateAttackModifier() - 攻撃力修正適用
   ✅ attack(): calculateDamageReduction() - ダメージ軽減適用
   ✅ attack(): canAttack() - 攻撃可能チェック
   ✅ destroyMonster(): unregister() - 効果解除
   ✅ useMagicCard(): calculateMagicCostModifier() - 魔法コスト修正
   ✅ useMagicCard(): tryNegateMagic() - 魔法無効化チェック
   ✅ executeSkill(): tryNegateSkill() - 技無効化チェック
   ✅ processPhase(): resetTurnFlags() - ターン使用フラグリセット
   ✅ getActualSummonCost(): calculateSummonCostModifier() - 召喚コスト計算

進捗率: 95% ✅ ⭐⭐⭐⭐
備考: 常時効果システムの基盤完成（~2736行）。
      45枚のカード（フィールドカード23枚＋モンスターカード22枚）の常時効果実装完了。
      残りの常時効果カード（約12枚）の実装が今後の課題。

コード統計:
- effectTypes.js: 224行（効果タイプ定義）
- targetTypes.js: 182行（ターゲットタイプ定義）
- conditionChecker.js: 303行（条件チェック）
- valueCalculator.js: 216行（値計算）
- effectEngine.js: 687行（メインエンジン）
- index.js: 106行（エクスポート集約）
- effectDefinitions/fieldCards.js: 390行（フィールドカード23枚）
- effectDefinitions/monsterCards.js: 368行（モンスターカード22枚）
- effectDefinitions/phaseCards.js: 183行（フェイズカード）
- effectDefinitions/index.js: 77行（定義集約）
- 合計: ~2736行の常時効果システム実装

次のステップ:
📋 残りの常時効果カードの実装（約12枚）
📋 常時効果のUI表示（バフ/デバフアイコン）
📋 常時効果ログの改善

================================================================================
【完了】Phase 8: AI対戦モード（旧Phase 7）⭐⭐⭐⭐⭐ **2025-11-27 完了**
================================================================================
優先度: ★☆☆（低〜中）→ ★★★（高）に昇格して完了
目的: 1人でもプレイ可能にする

✅ 8-1. 基本AI（Easy）
   ✅ ランダムカード選択（30%スキップ）
   ✅ コストに応じた召喚判断
   ✅ 攻撃可能なら攻撃（70%直接攻撃優先）

✅ 8-2. 中級AI（Normal）
   ✅ コスト効率による召喚優先度
   ✅ 有利な攻撃対象の選択（HP低い敵優先、倒せる敵を狙う）
   ✅ 魔法カードの適切な使用（30%使用）
   ✅ 上級技の積極使用、基本技30%使用
   ✅ トリガー50%使用

✅ 8-3. 上級AI（Hard）
   ✅ フィールド状況を考慮した召喚判断
   ✅ ダメージ効率最大化の攻撃対象選択
   ✅ 刹那詠唱の状況判断使用
   ✅ 上級技常に使用、基本技60%使用
   ✅ トリガー80%使用
   📋 デッキシナジーの理解（将来拡張）
   📋 複数ターン先の計画（将来拡張）

✅ 8-4. AIシステム基盤
   ✅ プレイヤーごとのAI/人間切り替え（P1/P2個別設定）
   ✅ タイトル画面のAI設定UI
   ✅ ストラテジーパターンによる判断基準の差し替え
   ✅ 特殊ケース対応（手札選択、ターゲット選択、墓地選択、デッキ確認、チェーン確認）
   ✅ AI思考ディレイ（人間らしさのため）

📋 8-5. デッキ専用AI（将来拡張）
   📋 ドラゴンデッキ専用AI
   📋 氷眠の檻デッキ専用AI
   📋 その他デッキ専用AI

進捗率: 90% ✅（基本機能完了、デッキ専用AIは将来拡張）
新規ファイル: src/engine/ai/ (~1,015行)
詳細設計: src/ルール/ai-player-system-design.md

================================================================================
【未着手】Phase 9: デッキ構築（旧Phase 8）
================================================================================
優先度: ★☆☆（低）
目的: カスタムデッキでの対戦

📋 9-1. デッキ構築画面
   📋 全カードリスト表示
   📋 フィルター（属性、コスト、種類）
   📋 検索機能

📋 9-2. デッキルールの適用
   ✅ 40枚固定 ← ランダムデッキ生成で実装済み
   ✅ 同一カード3枚まで ← ランダムデッキ生成で実装済み
   ✅ 禁忌カード1枚まで ← ランダムデッキ生成で実装済み

📋 9-3. デッキ保存/読み込み
   📋 ローカルストレージへの保存
   📋 プリセットデッキ

進捗率: 30% 📋
備考: デッキルールは実装済みだが、UI未実装。

================================================================================
【部分実装】Phase 10: UI/UX改善（旧Phase 9）
================================================================================
優先度: ★☆☆（低）
目的: より遊びやすく、見やすく

🚧 10-1. カードデザイン改善
   📋 カードイラスト表示エリア
   ✅ 属性アイコン（色彩グラデーション）
   📋 レアリティ表示

🚧 10-2. アニメーション追加
   📋 カード召喚エフェクト
   📋 攻撃エフェクト
   ✅ ダメージ表示（ログ）

📋 10-3. サウンド（将来）
   📋 BGM
   📋 効果音

📋 10-4. レスポンシブ対応
   📋 モバイル対応
   📋 画面サイズ調整

✅ 10-5. カード操作UI改善【2025-11-26実装】
   ✅ 魔法カード専用発動ボタンの追加
   ✅ フィールド/フェイズカード情報パネル
   ✅ フィールドカードとフェイズカードの横並び配置
   ✅ カード情報表示のバグ修正（両プレイヤーエリアに表示される問題）
   ✅ 魔法カード発動のUX改善（フェーズ遷移と分離）

✅ 10-6. 効果関連UI改善【2025-11-27実装】⭐ NEW
   ✅ 手札選択システム（ソラリア等の選択必須効果対応）
   ✅ コスト軽減表示（緑=軽減、赤=増加、ツールチップ対応）
   ✅ デッキトップ確認UI（DeckReviewModal - ドラッグ並び替え、選択モード対応）⭐ NEW
   ✅ 墓地UI・墓地選択システム（閲覧、選択、トリガー発動）⭐ NEW

進捗率: 60% 🚧
備考: カード操作UIが大幅に改善。墓地UI・デッキトップUIが完成し、ゲームとしての基盤が整った。

================================================================================
【全体進捗サマリー】
================================================================================

Phase 1: プロトタイプ              ✅ 100% 完了
Phase 2: カードデータ完全実装      ✅ 95%  完了
Phase 3: 技システム実装            ✅ 85%  大幅拡張
Phase 4: キーワード能力実装        🚧 75%  刹那詠唱・状態異常完了、残りキーワード実装中 ⭐⭐⭐
Phase 5: フェイズカード実装        ✅ 95%  実装完了（段階進行ロジック、CSVテキストパース方式）⭐
Phase 6: 効果エンジン実装          ✅ 80%  大幅拡張
Phase 6.5: トリガーシステム        ✅ 95%  完了（7955行、220+カード）⭐⭐⭐
Phase 7: 常時効果システム          ✅ 95%  完了（2798行、45カード）⭐⭐⭐⭐
Phase 8: AI対戦モード              ✅ 90%  完了（1246行）⭐⭐⭐⭐⭐
Phase 9: デッキ構築                📋 30%  未着手
Phase 10: UI/UX改善                🚧 65%  大幅進展（墓地UI・デッキトップUI・手札選択完成）⭐⭐

総合進捗: 約90%

【2025-11-27の進展】⭐⭐⭐⭐ NEW（大幅進展）
-1. AIプレイヤーシステム実装【完了】⭐⭐⭐⭐⭐⭐⭐ **最新**
   - AIシステム基盤完成（src/engine/ai/ - ~1,015行）
   - 3段階の難易度AI: かんたん/ふつう/むずかしい
   - プレイヤーごとのAI/人間切り替え（P1/P2個別設定可能）
   - タイトル画面のAI設定UI
   - ストラテジーパターンによる拡張可能な設計
   - 特殊ケース対応: 手札選択、モンスターターゲット、墓地選択、デッキ確認、チェーン確認
   - AI vs AI 自動対戦可能
   - 詳細設計: src/ルール/ai-player-system-design.md

0. 状態異常システム実装【完了】⭐⭐⭐⭐⭐⭐
   - 状態異常エンジン完成（statusEffects/ - ~580行）
   - 13種類の状態異常タイプ定義（眠り、凍結、雷撃、濡れ、守護、毒など）
   - ゲーム統合完了（ターン開始/エンドフェイズ処理、攻撃/技制限）
   - 状態異常付与ヘルパー4種（effectHelpers.js）
   - UI実装（FieldMonster.jsx - 状態異常アイコン表示）
   - 氷眠の檻デッキ追加（prebuiltDecks.js）
   - 凍結/眠り付与カード6枚実装
1. 手札選択システム実装
   - 効果でプレイヤーの選択が必要な場合のUI（ソラリア等）
   - pendingHandSelection + pendingSelectedCardによる2段階確認
2. ON_SUMMONトリガーのスコープ修正
   - 召喚されたカード自身のみ発火するように変更
3. コスト軽減表示システム
   - 手札のカードにコスト修正を色付きで表示
   - ツールチップで元のコストと修正ソースを表示
4. hasCategory()ヘルパー関数追加
   - カテゴリ比較を【】付き/なし両方に対応
   - 10ファイルにわたるカテゴリ比較を統一
5. 墓地UI・墓地操作システム実装【完了】⭐ NEW
   - 墓地閲覧モーダル（クリックで一覧表示）
   - 墓地からのカード選択UI（蘇生・回収効果用）
   - 墓地トリガー発動UI（ON_MAIN_PHASE_FROM_GRAVEYARD等）
   - pendingGraveyardSelection + pendingGraveyardSelectedCardによる選択
6. デッキトップ確認・操作UI実装【完了】⭐ NEW
   - DeckReviewModalコンポーネント（543行）
   - @dnd-kitによるドラッグ＆ドロップ並び替え
   - 選択モード・フィルタリング対応
   - タロス等のデッキ操作効果に完全対応
7. キーワード能力システム - 【刹那詠唱】実装【完了】⭐⭐ NEW
   - keywordAbilities/index.js: キーワード能力基盤
   - チェーンポイントシステム: バトル開始・攻撃宣言時に発動確認
   - チェーン確認ダイアログUI: カード選択→発動/スキップ
   - コスト計算: 通常コスト + 1 SP
   - Phase A実装: 1チェーン（相互チェーン不可）
   - Phase B準備: スタック構造（LIFO解決対応）
   - 公式ルール仕様書 ver2.3 に更新
   - chain-system-design.md: 詳細設計書

【2025-11-26の大幅進展】
1. Phase 3 + Phase 6の大幅拡張により、ゲームの中核となる効果システムが確立。
   108+カードの固有エフェクト実装完了（~2361行の新規コード）。
2. Phase 5（フェイズカード）実装完了 ⭐
   - フィールドカードとフェイズカードの分離、横並び配置、情報パネル実装
   - 段階進行ロジック実装（CSVテキストパース方式）
   - 現在/次の段階効果をUIに表示
   - フェイズカードでフェイズカードをチャージ可能
3. Phase 10（UI/UX改善）の進展。
   魔法カード専用発動ボタン追加、カード操作UX改善、バグ修正。
4. Phase 7（常時効果システム）完全実装 ⭐⭐⭐⭐ **最新**
   - 常時効果エンジン完成（~2736行）
   - 45枚のカード（フィールド23枚＋モンスター22枚）の常時効果実装
   - 攻撃力/HP修正、ダメージ軽減、コスト修正、攻撃制限、無効化など12種類の効果タイプ
   - フェイズカードの段階別常時効果にも対応

================================================================================
【現在の実装における強み】
================================================================================

✅ 完全なCSVパーサー
   - 433枚のカードデータを正しく読み込み
   - 複雑な引用符やエスケープ処理に対応
   - 技情報の自動抽出

✅ 堅牢な基本ゲームシステム
   - SPトークン管理
   - フェイズ進行
   - 基本的な戦闘システム
   - ライフポイント管理

✅ 良好なUI/UX【2025-11-26大幅改善】
   - 視覚的に分かりやすいカード表示
   - フェイズインジケーター
   - ゲームログ
   - 選択カード詳細パネル
   - 技アイコン表示
   - 魔法カード専用発動ボタン ✅
   - フィールド/フェイズカード情報パネル ✅
   - フィールドカードとフェイズカードの横並び配置 ✅
   - カード情報表示のバグ修正完了 ✅

✅ チャージシステムの実装
   - チャージ機能の実装
   - 技発動UIの実装
   - 属性・枚数チェック

✅ 高度な効果システム【2025-11-26新規】
   - ハイブリッド効果エンジン（ジェネリック + カード固有）
   - 108+カードの固有エフェクト実装
   - 再利用可能なエフェクトヘルパーライブラリ（9関数）
   - 属性別に整理されたカードエフェクト（7ファイル）
   - エフェクトレジストリによる一元管理
   - テンプレートベースの拡張性

✅ 常時効果システム【2025-11-26新規】⭐⭐⭐⭐
   - 状態ベース型の継続効果処理
   - 12種類の効果タイプ（攻撃力修正、HP修正、ダメージ軽減等）
   - 45枚のカード（フィールド23枚＋モンスター22枚）の常時効果
   - 条件チェックシステム（属性、カテゴリ、名前、ライフ等）
   - 値計算システム（固定値、数量×基本値、条件付き値）
   - フェイズカードの段階別効果にも対応

✅ モジュラーアーキテクチャ【2025-11-26リファクタリング】
   - 明確な関心の分離（UI / ロジック / データ）
   - 独立したコンポーネント（4ファイル）
   - ユーティリティ関数の整理（3ファイル）
   - エンジン層の確立（3ファイル + cardEffects/）
   - 39%のコード削減（2237行 → 1366行 + モジュール）

================================================================================
【現在の実装における課題】
================================================================================

🚧 カード固有エフェクトの残り実装
   - 108カード実装済み / 433カード中
   - 残り325カードの固有エフェクト実装が必要
   - 既存のヘルパー関数とテンプレートで実装は容易

📋 高度な効果の実装
   - SPトークン操作（増減、奪取）
   - コントロール奪取（モンスターの所有権変更）
   - 永続効果（ターン跨ぎのバフ/デバフ）
   - 複雑な条件分岐効果

🚧 キーワード能力の一部が未実装
   - 【刹那詠唱】は実装完了 ✅
   - 状態異常システムは実装完了 ✅
   - 残り: 【覚醒】【死触】【魔障壁】【毒侵】【深蝕】【変幻身】【壮麗】【魂結】【犠現】【残魂】【威圧吼】【未来予知】

✅ フェイズカードの段階的強化【2025-11-26実装完了】
   - データ構造対応済み ✅
   - UI実装済み（分離配置、情報パネル）✅
   - 設置・発動機能実装済み ✅
   - 段階的強化システムのロジック実装済み ✅
   - CSVテキストパース方式で段階効果を取得 ✅
   - フェイズカードでフェイズカードをチャージ可能 ✅

⚠️ デッキ構築UIがない
   - ランダムデッキのみ
   - カスタムデッキが組めない

✅ AI対戦【2025-11-27実装完了】
   - 3段階の難易度AI（かんたん/ふつう/むずかしい）
   - プレイヤーごとのAI/人間切り替え可能
   - AI vs AI 自動対戦可能

✅ トリガー効果【2025-11-26実装完了】
   - 26種類のトリガータイプ実装済み
   - 220+カードのトリガー実装済み（7955行）
   - 召喚時、破壊時、各フェイズトリガー全対応

================================================================================
【推奨開発順序（更新版）】2025-11-28
================================================================================

次のステップ（優先度順）:

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 完了済み（2025-11-27）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ AIプレイヤーシステム【完了】⭐⭐⭐⭐⭐
   - 3段階の難易度AI（かんたん/ふつう/むずかしい）
   - プレイヤーごとのAI/人間切り替え可能
   - AI vs AI 自動対戦可能
   - src/engine/ai/（~1246行）

✅ 状態異常システム【完了】⭐⭐⭐
   - 13種類の状態異常タイプ
   - ゲーム統合完了（ターン開始/エンドフェイズ処理）
   - 状態アイコン表示UI
   - src/engine/statusEffects/（~982行）

✅ 墓地UI・墓地操作システム【完了】
   - 墓地カード閲覧UI（墓地クリックで一覧表示）
   - 墓地からカード選択UI（蘇生・回収効果用）
   - 墓地トリガー発動UI（ON_MAIN_PHASE_FROM_GRAVEYARD等）

✅ デッキトップ確認・操作UI【完了】
   - DeckReviewModalコンポーネント（543行）
   - ドラッグ＆ドロップによる並び替え（@dnd-kit使用）
   - 選択モード・フィルタリング対応

✅ 【刹那詠唱】実装【完了】⭐⭐
   - チェーンポイントシステム（バトル開始・攻撃宣言時）
   - チェーン確認ダイアログUI
   - コスト計算: 通常コスト + 1 SP

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔥 即時実装候補（プレイ体験向上に直結）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. 【最優先】残りのキーワード能力実装
   - 【覚醒】: 条件達成で攻撃力上昇（トリガーシステムで実装可能）
   - 【死触】: ダメージを与えれば即破壊（攻撃処理に追加）
   - 【魔障壁】: 魔法耐性（常時効果システムで実装可能）
   - 【毒侵】: 毒状態付与（状態異常システムで実装可能）
   - 推定工数: 中

2. 【高優先】残りカードのエフェクト・トリガー実装
   - エフェクト: 残り約230カード（433 - 実装済み）
   - トリガー: 残り約200カード（433 - 220）
   - 重要カード・人気カードから優先

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 中期実装候補（ゲーム完成度向上）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

3. 高度な効果の実装
   - SPトークン操作（増減、奪取）
   - コントロール奪取（モンスターの所有権変更）
   - 永続効果（ターン跨ぎのバフ/デバフ）

4. デッキ構築UI
   - カード選択画面
   - デッキ保存/読み込み（localStorage）
   - プリセットデッキ拡充

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎮 長期実装候補（ゲーム拡張）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

5. UI/UX改善
   - アニメーション（召喚、攻撃エフェクト）
   - カードイラスト表示
   - モバイル対応
   - サウンド（BGM、効果音）

6. デッキ専用AI
   - ドラゴンデッキ専用AI
   - 氷眠の檻デッキ専用AI
   - その他デッキ専用AI

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📌 実装推奨順序の理由
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. ✅ 墓地UI・デッキトップUI【完了】
   - 既存のトリガー・エフェクトが正しく動作

2. ✅ AIプレイヤーシステム【完了】
   - 1人プレイ可能、デバッグ効率向上

3. ✅ 状態異常システム【完了】
   - 戦略の幅が大幅に拡大

4. 残りのキーワード能力が次の優先:
   - カードの差別化がさらに向上
   - 既存システム（常時効果・トリガー・状態異常）を活用可能
   - 【覚醒】【死触】【魔障壁】等は既存基盤で実装容易

5. カード実装が中期の理由:
   - 既に200+カードのトリガー実装済み
   - 基盤システムが完成しており一括実装が効率的
   - 既存テンプレートとヘルパーで実装は容易

【短期目標】（次の1-2週間）
- キーワード能力2-3種の実装（【覚醒】【死触】【魔障壁】）
- 残りカードの固有エフェクト30カード追加

【中期目標】（1ヶ月）
- キーワード能力の完全実装
- 残りカードの固有エフェクト100カード追加
- デッキ構築UIの基盤

【長期目標】（2-3ヶ月）
- 全433カードの固有エフェクト・トリガー実装完了
- デッキ構築UI完成
- UI/UXの大幅改善（アニメーション、サウンド）

================================================================================
【技術的な改善点】
================================================================================

現在のコードの良い点:
✅ Reactのhooksを適切に使用
✅ 状態管理が明確
✅ カードの一意性を保証（uniqueId）
✅ エラーハンドリングが適切
✅ CSVパーサーが堅牢
✅ モジュラーアーキテクチャ（関心の分離が明確）
✅ 効果エンジンのアーキテクチャが確立（2025-11-26）
✅ 再利用可能なエフェクトヘルパーライブラリ（2025-11-26）
✅ カード固有エフェクトの拡張性（2025-11-26）

改善が必要な点:
🚧 カード固有エフェクトの残り実装
   → 108カード実装済み、残り325カード
   → 既存テンプレートとヘルパーで実装可能

📋 永続効果の状態管理
   → ターン跨ぎのバフ/デバフを管理する仕組みが必要
   → フィールドモンスターに永続効果配列を追加検討

📋 トリガーシステムの拡張
   → 破壊時、フェイズ開始時等のトリガーフック
   → イベント駆動の効果実行システム

⚠️ useCallbackの依存配列に改善の余地
   → 一部の関数で依存関係が不完全（優先度: 低）

✅ 実施済みリファクタリング（2025-11-26完了）:
1. ✅ 効果実行エンジンの分離（effectEngine.js 220行）
2. ✅ エフェクトヘルパーの分離（effectHelpers.js 446行）
3. ✅ カード固有エフェクトの分離（cardEffects/ ~1695行）
4. ✅ カードデータ管理の分離（cardManager.js）
5. ✅ UIコンポーネントの分離（components/）
6. ✅ スタイル定義の分離（gameStyles.js）
7. ✅ 定数とヘルパー関数の分離（constants.js, helpers.js）

📋 将来の推奨リファクタリング:
1. ✅ トリガーシステムの実装 ← 完了！ ⭐⭐⭐
2. 永続効果管理システムの追加 ← 優先度: 高
3. キーワード能力システムの分離（keywordSystem.js）← 優先度: 高
4. バトルロジックの分離（battleSystem.js）← 優先度: 中
5. フェーズシステムの分離（phaseSystem.js）← 優先度: 低

================================================================================
【コードリファクタリング実施状況】2025-11-26
================================================================================
✅ 完了（Phase 1-4実施 + Phase 5実装）

【Phase 1-4】基本リファクタリング:
- magic-spirit.jsx: 2237行 → 1366行（-871行、39%削減）
- 新規ファイル作成: 9個
  - utils/: constants.js, helpers.js, cardManager.js
  - components/: Card.jsx, FieldMonster.jsx, SPTokens.jsx, GameLog.jsx
  - styles/: gameStyles.js
  - engine/: effectEngine.js

【Phase 5】カード固有エフェクトシステム実装:
- 新規ファイル作成: 9個（~2361行の新規コード）
  - engine/effectHelpers.js: 446行（9つの再利用可能ヘルパー関数）
  - engine/cardEffects/index.js: エフェクトレジストリ
  - engine/cardEffects/_template.js: 新カード用テンプレート
  - engine/cardEffects/fire.js: 炎属性カードエフェクト
  - engine/cardEffects/water.js: 水属性カードエフェクト
  - engine/cardEffects/light.js: 光属性カードエフェクト
  - engine/cardEffects/dark.js: 闇属性カードエフェクト
  - engine/cardEffects/primitive.js: 原始属性カードエフェクト
  - engine/cardEffects/future.js: 未来属性カードエフェクト
  - engine/cardEffects/neutral.js: なし属性カードエフェクト

実装済みカード数: 108+カード / 433カード中（25%）

【Phase 6.5】トリガーシステム実装: ⭐⭐⭐
- 新規ファイル作成: 7個（~6407行の新規コード）
  - engine/triggerTypes.js: 372行（26種類のトリガータイプ定義）
  - engine/triggerEngine.js: 660行（トリガー管理システム）
  - engine/cardTriggers/fireCards.js: 819行（炎属性33枚）
  - engine/cardTriggers/waterCards.js: 970行（水属性34枚）
  - engine/cardTriggers/lightCards.js: 1309行（光属性47枚） ⭐
  - engine/cardTriggers/darkCards.js: 1428行（闇属性42枚）
  - engine/cardTriggers/futureCards.js: 504行（未来属性12枚）
  - magic-spirit.jsx: 345行追加（トリガー統合コード）
- ドキュメント作成: 4個（~3579行）
  - src/ルール/trigger-implementation-guide.md: 1268行
  - src/ルール/trigger-specifications.md: 941行
  - src/ルール/trigger-revision-plan.md: 823行
  - src/ルール/trigger-system-design.md: 547行

実装済みトリガーカード数: 168カード / 433カード中（39%）

成果:
✅ 関心の分離: UI、ロジック、データ管理が明確に分離
✅ 保守性向上: 各ファイルの責務が明確化
✅ 拡張性向上: 新機能の追加が容易に
✅ テスト容易性: 各モジュールを個別にテスト可能
✅ エフェクトシステムの確立: ハイブリッドアプローチで柔軟な実装
✅ 再利用性向上: エフェクトヘルパーで共通パターンを効率化
✅ 属性別整理: カードエフェクトが属性ごとに整理され管理しやすい

効果エンジン（effectEngine.js 220行 + effectHelpers.js 446行 +
cardEffects/ ~1695行）の実装により、Phase 3（技効果拡張）とPhase 6
（効果エンジン実装）が大幅に進展しました。

詳細: src/ルール/code-structure.md を参照

================================================================================
【参照ファイル】
================================================================================
【ルール・仕様書】
- ルール仕様書: /mnt/project/マジックスピリット_公式ルール仕様書_ver2_11.txt
- フェイズカードルール: /mnt/project/マジックスピリット_-_フェイズカードルール__ver1_0_.txt
- 技発動ルール: /mnt/project/マジックスピリット_-_属性カードをエネルギーとする技発動ルール__ver1_1_.txt
- カードリスト: /mnt/project/cardlist.csv（433カード）

【ドキュメント】
- コード構成: src/ルール/code-structure.md
- 開発ガイド: CLAUDE.md（v3.3、2025-11-26更新）⭐
- 本ロードマップ: src/ルール/magic-spirit-roadmap-updated.txt
- トリガーシステム設計: src/ルール/trigger-system-design.md ⭐ NEW
- トリガー仕様書: src/ルール/trigger-specifications.md ⭐ NEW
- トリガー実装ガイド: src/ルール/trigger-implementation-guide.md ⭐ NEW
- トリガー修正方針: src/ルール/trigger-revision-plan.md ⭐ NEW

【主要実装ファイル】
- メインゲーム: src/magic-spirit.jsx（1366行）
- カードマネージャー: src/utils/cardManager.js（240行）
- 定数: src/utils/constants.js（32行）
- ヘルパー関数: src/utils/helpers.js（64行）

【エフェクトシステム】⭐⭐ 最重要
- 効果エンジン: src/engine/effectEngine.js（220行）
- 効果ヘルパー: src/engine/effectHelpers.js（446行）
- カード固有エフェクト: src/engine/cardEffects/
  - index.js: エフェクトレジストリ
  - _template.js: 新カード用テンプレート
  - fire.js, water.js, light.js, dark.js, primitive.js, future.js, neutral.js

【トリガーシステム】⭐⭐⭐ 最重要
- トリガータイプ定義: src/engine/triggerTypes.js（372行）
- トリガーエンジン: src/engine/triggerEngine.js（660行）
- カード固有トリガー: src/engine/cardTriggers/
  - fireCards.js（33枚、819行）
  - waterCards.js（34枚、970行）
  - lightCards.js（47枚、1309行）⭐ 最多
  - darkCards.js（42枚、1428行）
  - futureCards.js（12枚、504行）

【常時効果システム】⭐⭐⭐⭐ 最重要・最新実装
- 効果タイプ定義: src/engine/continuousEffects/effectTypes.js（224行）
- ターゲットタイプ: src/engine/continuousEffects/targetTypes.js（182行）
- 条件チェック: src/engine/continuousEffects/conditionChecker.js（303行）
- 値計算: src/engine/continuousEffects/valueCalculator.js（216行）
- 効果エンジン: src/engine/continuousEffects/effectEngine.js（687行）
- エクスポート: src/engine/continuousEffects/index.js（106行）
- 効果定義: src/engine/continuousEffects/effectDefinitions/
  - index.js（77行）
  - fieldCards.js（390行、23枚）
  - monsterCards.js（368行、22枚）
  - phaseCards.js（183行）
- 設計書: src/ルール/continuous-effect-system-design.md（1247行）

【UIコンポーネント】
- カード表示: src/components/Card.jsx（195行）
- フィールドモンスター: src/components/FieldMonster.jsx（166行）
- SPトークン: src/components/SPTokens.jsx（38行）
- ゲームログ: src/components/GameLog.jsx（20行）

【スタイル】
- ゲームスタイル: src/styles/gameStyles.js（165行）

================================================================================
【結論】2025-11-26更新
================================================================================

現在の実装状況:
✅ 基本的なゲームシステムが完成（Phase 1完了）
✅ カードデータの読み込みシステムが完成（Phase 2完了）
✅ チャージと技発動システムが完成（Phase 3: 85%完了）
✅ コードリファクタリングが完了（2237行→1366行、39%削減）
✅ 効果実行エンジンが完成（Phase 6: 80%完了）
✅ カード固有エフェクトシステムが確立（108+カード実装済み）
✅ エフェクトヘルパーライブラリが完成（9つの再利用可能関数）
✅ ハイブリッド効果システムが稼働（ジェネリック + カード固有）
✅ フェイズカードUI実装完了（Phase 5: 95%完了）
✅ UI/UX大幅改善（Phase 10: 30%完了）
✅ 常時効果システム完成（Phase 7: 95%完了）⭐⭐⭐⭐ NEW

【2025-11-26の大きな進展】⭐⭐⭐
1. カード固有エフェクトシステム完成:
   ✅ effectHelpers.js（446行）: 9つの再利用可能ヘルパー関数
      - millDeck, conditionalDamage, searchCard, reviveFromGraveyard
      - destroyMonster, drawCards, healLife, modifyAttack, modifyHP
   ✅ cardEffects/（~1695行）: 108+カードの固有エフェクト実装
      - 属性別に整理（fire, water, light, dark, primitive, future, neutral）
      - エフェクトレジストリで一元管理
      - テンプレートで拡張性を確保

2. フェイズカードUI実装完了:
   ✅ フィールドカードとフェイズカードの分離
   ✅ 横並び配置UI
   ✅ フィールド/フェイズカード情報パネル
   ✅ 設置・発動機能の基本実装
   🚧 段階的強化ロジック未実装

3. UI/UX改善とバグ修正:
   ✅ 魔法カード専用発動ボタン追加
   ✅ カード情報表示バグ修正（両プレイヤーエリアに表示される問題）
   ✅ 魔法カード発動のUX改善（フェーズ遷移と分離）

4. トリガーシステム完全実装: ⭐⭐⭐
   ✅ トリガータイプシステム（triggerTypes.js - 372行）
      - 26種類の汎用トリガータイプ定義
      - 自動/任意発動の区別、優先度システム
   ✅ トリガーエンジン（triggerEngine.js - 660行）
      - グローバルトリガーレジストリ
      - 自動発火・手動発動システム
      - ターン管理・優先度制御
   ✅ カード固有トリガー実装（cardTriggers/ - 5030行、168枚）
      - 炎属性: 33枚（819行）
      - 水属性: 34枚（970行）
      - 光属性: 47枚（1309行） ⭐ 最多
      - 闇属性: 42枚（1428行）
      - 未来属性: 12枚（504行）
   ✅ トリガーシステムドキュメント（3579行）
      - 4ファイルの包括的なドキュメント
      - 実装ガイド、仕様書、設計書、リビジョンプラン
   ✅ ゲーム統合（magic-spirit.jsx - 345行追加）
      - フェイズトリガー自動発火
      - UI統合（スキルパネル）
      - 破壊時・召喚時処理

5. 常時効果システム完全実装: ⭐⭐⭐⭐ **最新の進展**
   ✅ 常時効果タイプ定義（effectTypes.js - 224行）
      - 12種類の効果タイプ（ATK_MODIFIER, HP_MODIFIER等）
      - ターゲットタイプ、値計算タイプの体系化
   ✅ 条件チェックシステム（conditionChecker.js - 303行）
      - 属性、カテゴリ、名前、ライフ、ターン等の条件
      - 複合条件のサポート
   ✅ 常時効果エンジン（effectEngine.js - 687行）
      - ライフサイクル管理（登録/解除/リセット）
      - 計算メソッド群（攻撃力、HP、ダメージ、コスト）
      - 制限・無効化チェック
   ✅ カード効果定義（effectDefinitions/ - 1018行、45枚）
      - フィールドカード: 23枚（390行）
      - モンスターカード: 22枚（368行）
      - フェイズカード: 段階別効果対応（183行）
   ✅ ゲーム統合（magic-spirit.jsx）
      - 攻撃力/HP修正の自動適用
      - ダメージ軽減・無効化
      - 召喚/魔法コスト修正
      - 攻撃制限・技無効化

実装済みの効果:
✅ ダメージ（単体/全体/条件付き）
✅ 回復（HP/ライフ）
✅ バフ/デバフ（攻撃力/HP増減）
✅ サーチ（デッキから手札へ）
✅ 蘇生（墓地から場へ、弱体化対応）
✅ 破壊（モンスター指定破壊）
✅ ドロー効果
✅ デッキミル（自分/相手）
✅ 墓地・フィールド操作

実装済みトリガー効果: ⭐
✅ 召喚時トリガー（ON_SUMMON, ON_OPPONENT_SUMMON等）
✅ 破壊時トリガー（ON_DESTROY_SELF, ON_CATEGORY_MONSTER_DESTROYED等）
✅ フェイズトリガー（ON_TURN_START_SELF, ON_END_PHASE_SELF等）
✅ 攻撃関連トリガー（ON_ATTACK, ON_ATTACKED, ON_ATTACK_SUCCESS）
✅ 墓地発動トリガー（ON_MAIN_PHASE_FROM_GRAVEYARD等）

実装済み常時効果: ⭐⭐⭐⭐ NEW
✅ 攻撃力修正（ATK_MODIFIER）- 固定値、数量倍、条件付き
✅ HP修正（HP_MODIFIER）
✅ ダメージ軽減（DAMAGE_REDUCTION）- 1ターン1度制限対応
✅ ダメージ無効（DAMAGE_IMMUNITY）- 効果ダメージ/戦闘ダメージ別
✅ 与ダメージ修正（DAMAGE_DEALT_MODIFIER）
✅ 被ダメージ修正（DAMAGE_RECEIVED_MODIFIER）
✅ 召喚コスト修正（SUMMON_COST_MODIFIER）
✅ 魔法コスト修正（MAGIC_COST_MODIFIER）
✅ 攻撃制限（ATTACK_RESTRICTION）
✅ SP制限（SP_RESTRICTION）
✅ 魔法無効化（MAGIC_NEGATION）- 1ターン1度制限対応
✅ 技無効化（SKILL_NEGATION）- 基本技/上級技別
✅ 召喚時バフ（ON_SUMMON_BUFF）- 攻撃力/HP

残りの課題:
🚧 カード固有エフェクトの残り実装（325カード）
🚧 カード固有トリガーの残り実装（265カード）
📋 高度な効果（SPトークン操作、コントロール奪取、永続効果）
⚠️ キーワード能力が未実装
✅ フェイズカードの段階的強化ロジック実装完了【2025-11-26】
📋 墓地UIの実装（墓地トリガー用）

次の優先事項:
1. 【最優先】残りカードの固有エフェクト・トリガー実装
   - エフェクト: 残り325カード（433 - 108）
   - トリガー: 残り213カード（433 - 220）
   - 既存のテンプレートとヘルパーを活用
   - 重要カード・人気カードから優先的に実装

2. 【重要】Phase 4: キーワード能力の実装
   - 【覚醒】【刹那詠唱】【死触】【魔障壁】等
   - 状態異常システム（眠り、凍結、守護等）

4. 【中】墓地UI・常時効果の拡張
   - 墓地トリガー用のUI実装
   - 常時効果の詳細実装
   - カード選択・デッキ操作UI

5. Phase 6完了: 高度な効果の実装
   - SPトークン操作、コントロール奪取、永続効果

総合評価:
✅ ゲームの中核となる効果システムが確立
✅ 堅実な基盤構築が完了し、拡張性の高いアーキテクチャを実現
✅ 108+カードのエフェクト実装により、ゲームとして十分プレイ可能
✅ 220カードのトリガー実装により、イベントベース戦略が実現 ⭐
✅ フェイズカードの段階進行ロジック実装完了 ⭐
✅ UI/UX改善により、操作性が大幅に向上
✅ トリガーシステムの完成により、カードゲームとしての深みが大幅に向上 ⭐⭐⭐
✅ 常時効果システムの完成により、場の状態に応じた戦略性が実現 ⭐⭐⭐⭐ **最新**
✅ 総合進捗: 約78%（Phase 3 + Phase 5 + Phase 6 + Phase 6.5 + Phase 7の大幅進展）
→ 今後は残りカードの実装、キーワード能力の追加により、
  ゲームの完成度を更に高める段階

【マイルストーン】
- 2025-11-26 午前: Phase 1-4リファクタリング完了（39%コード削減）
- 2025-11-26 午後: カード固有エフェクト実装完了（108+カード、~2361行の新規コード）
- 2025-11-26 夕方: フェイズカードUI実装完了、UI/UX大幅改善、バグ修正
- 2025-11-26 夜: トリガーシステム完全実装 ⭐⭐⭐
  * トリガーエンジン・タイプ定義システム完成（~1032行）
  * 220カードのトリガー実装完了（~7270行、7属性）
  * 包括的ドキュメント作成（3579行、4ファイル）
  * 合計: ~11000行の新規実装
- 2025-11-26 深夜: フェイズカード段階進行ロジック実装完了 ⭐
  * phaseCardEffects.jsをCSVテキストパース方式に変更（658行→200行）
  * 情報パネルに現在/次の段階効果を表示
  * フェイズカードでフェイズカードをチャージ可能に
- 2025-11-26 深夜: 常時効果システム完全実装 ⭐⭐⭐⭐
  * 常時効果エンジン・タイプ定義システム完成（~1718行）
  * 45カードの常時効果実装完了（~1018行、フィールド23枚+モンスター22枚）
  * 12種類の効果タイプ、条件チェック、値計算の完全サポート
  * フェイズカード段階別効果対応（183行）
  * 設計書作成（1247行）
  * 合計: ~2736行の新規実装
- 2025-11-27: 手札選択システム・コスト表示・バグ修正 ⭐⭐⭐⭐⭐ **最新**
  * 手札選択システム実装（効果でプレイヤーの選択が必要な場合のUI）
    - pendingHandSelection + pendingSelectedCardによる2段階確認
    - 選択中は通常アクション無効化
    - ソラリア等の選択必須効果に対応
  * ON_SUMMONトリガーのスコープ修正
    - 召喚されたカード自身のみ発火するように変更
    - 他のカード召喚では発火しない正しい動作に修正
  * コスト軽減表示システム
    - 手札のカードにコスト修正を色付きで表示（緑=軽減、赤=増加）
    - ツールチップで元のコストと修正ソースを表示
  * hasCategory()ヘルパー関数追加
    - カテゴリ比較を【】付き/なし両方に対応
    - 10ファイルにわたるカテゴリ比較を統一
- 2025-11-27: 状態異常システム実装 ⭐⭐⭐⭐⭐⭐ **最新**
  * 状態異常エンジン完成（statusEffects/ - ~580行）
    - statusTypes.js: 13種類の状態異常タイプ定義
    - statusEngine.js: メインエンジン（付与/解除/チェック/処理）
    - index.js: エクスポート集約
  * ゲーム統合完了（magic-spirit.jsx）
    - プレイヤー状態異常ステート追加
    - ターン開始/エンドフェイズ処理
    - 攻撃/技制限チェック
    - ダメージ計算への統合
  * 状態異常付与ヘルパー4種（effectHelpers.js）
  * UI実装（FieldMonster.jsx - 状態異常アイコン表示）
  * 氷眠の檻デッキ追加（prebuiltDecks.js）
  * 凍結/眠り付与カード6枚実装
    - C0000039, C0000144, C0000145, C0000150, C0000157, C0000199
- 総合進捗: 40% → 55% → 57% → 68% → 72% → 78% → 80% → 82%（+42%）

================================================================================
