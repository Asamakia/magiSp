================================================================================
マジックスピリット カードゲーム 開発ロードマップ（進捗更新版）
================================================================================
最終更新日: 2025年
現在のステータス: Phase 2 完了 / Phase 3 部分実装

進捗凡例:
✅ 完了
🚧 実装中
📋 未着手
⚠️ 要改善

================================================================================
【完了済み】Phase 1: プロトタイプ
================================================================================
✅ 基本ルール実装
   ✅ ライフポイント 6000
   ✅ SPトークン管理（最大10、アクティブ/レスト状態）
   ✅ 5フェイズターン進行（ターン開始→ドロー→メイン→バトル→エンド）
   ✅ 先攻1ターン目の攻撃制限

✅ カードシステム
   ✅ モンスター召喚（コスト支払い）
   ✅ 魔法カード発動
   ✅ フィールドカード設置
   ✅ 30種類のサンプルカード実装

✅ バトルシステム
   ✅ モンスター攻撃
   ✅ 反撃ダメージ（攻撃力の30%）
   ✅ ダイレクトアタック
   ✅ ダメージ軽減（モンスター存在時50%、フィールドカード存在時75%）

✅ UI/UX
   ✅ 2人対戦画面
   ✅ カード選択・効果表示
   ✅ HPバー、SPトークン表示
   ✅ ゲームログ
   ✅ フェイズ進行表示
   ✅ 選択カード詳細表示パネル
   ✅ 攻撃可能インジケーター
   ✅ チャージ数表示

================================================================================
【完了】Phase 2: カードデータ完全実装
================================================================================
優先度: ★★★（高）
目的: 全433枚のカードを使用可能にする

✅ 2-1. CSVパーサーの実装
   ✅ /mnt/project/cardlist.csv を読み込み
   ✅ カードID、名称、属性、コスト、種類、キーワード能力、攻撃力、HP、
     カテゴリ、効果、フレーバーテキストをパース
   ✅ 複数行にまたがる効果テキストの対応（引用符内改行の処理）
   ✅ エスケープされた引用符の処理

✅ 2-2. カードデータ構造の拡張
   ✅ キーワード能力フィールドの追加（配列形式）
   ✅ カテゴリ（【ドラゴン】【スライム】等）の配列化
   ✅ 禁忌カードフラグの追加
   ✅ 技情報の抽出（基本技・上級技）

✅ 2-3. カード種類の完全対応
   ✅ monster（モンスター）
   ✅ magic（魔法）
   ✅ field（フィールド）
   🚧 phase（フェイズカード）← データ構造は対応済み、ゲームロジック未実装

✅ 2-4. CSVファイルの非同期読み込み
   ✅ /cardlist/cardlist.csv からの読み込み
   ✅ エラーハンドリング（サンプルカードへのフォールバック）
   ✅ ローディング状態の表示

進捗率: 95% ✅
備考: CSVパーサーは完全に実装され、433枚のカードが読み込み可能。
      フェイズカードのゲームロジックのみ未実装。

================================================================================
【部分実装】Phase 3: 技システム実装
================================================================================
優先度: ★★★（高）
目的: チャージによる基本技・上級技を実装

✅ 3-1. チャージシステム
   ✅ 属性カードをモンスターに重ねる機能
   ✅ 1モンスターにつき最大2枚チャージ
   ✅ 1ターンに1回のチャージ制限（プレイヤー全体）
   🚧 属性チャージ vs SPチャージの選択 ← 実装済みだが要テスト
   ✅ チャージカードが場に残る仕様

🚧 3-2. 基本技の実装
   ✅ 1枚チャージで発動
   ✅ 同属性カードのみ発動可能のチェック
   ✅ 「任意」指定の場合は全属性対応
   🚧 技発動後もチャージカードは場に残る
   ⚠️ 技効果のパーサーが簡易実装（ダメージ・回復のみ）

🚧 3-3. 上級技の実装
   ✅ 2枚チャージで発動
   ✅ 強力な効果（実装は簡易版）
   ✅ チャージ枚数チェック
   ⚠️ 一部効果のみ実装

🚧 3-4. 技効果のパーサー
   ✅ 効果テキストから技を抽出
   ✅ 「基本技：」「上級技：」のパターンマッチ
   🚧 ダメージ、回復、状態変化等の効果分類 ← ダメージ・回復のみ実装
   📋 複雑な効果（サーチ、蘇生、破壊、コントロール奪取等）未実装

進捗率: 60% 🚧
備考: 基本的なチャージと技発動の仕組みは実装済み。
      技効果のパーサーは簡易版で、複雑な効果は未実装。

現在の実装状況:
- チャージ機能: 動作確認済み
- 基本技・上級技の発動UI: 実装済み
- 技効果の実行: ダメージと回復のみ実装
- 属性チェック: 実装済み
- チャージ枚数チェック: 実装済み

未実装の技効果:
- バフ/デバフ（攻撃力/HP増減の永続化）
- サーチ（デッキから手札へ）
- 蘇生（墓地から場へ）
- 破壊（モンスター/カード指定破壊）
- ドロー効果
- SPトークン操作
- コントロール奪取

================================================================================
【未着手】Phase 4: キーワード能力実装
================================================================================
優先度: ★★☆（中）
目的: 特殊能力を持つカードの差別化

📋 4-1. 主要キーワード能力
   ✅ データ構造には対応済み（keywordフィールド）
   📋 【覚醒】: 条件達成で攻撃力上昇 ← パースはされるが効果未実装
   📋 【刹那詠唱】: SP追加で相手ターンに発動可能
   📋 【死触】: ダメージを与えれば即破壊
   📋 【魔障壁】: 魔法耐性
   ✅ 【禁忌カード】: デッキに1枚制限（デッキ構築時に対応予定）

📋 4-2. 状態異常システム
   📋 眠り: 行動不能、効果無効、50%で解除
   📋 凍結: 行動不能
   📋 行動不能: 攻撃・効果使用不可
   📋 守護: ダメージ半減（1回）
   📋 効果無効: 効果が発動しない

📋 4-3. 状態異常の表示
   📋 モンスターカードに状態アイコン表示
   📋 ターン経過による自動解除

進捗率: 10% 📋
備考: データ構造のみ対応。ゲームロジック未実装。

================================================================================
【未着手】Phase 5: フェイズカード実装
================================================================================
優先度: ★★☆（中）
目的: 段階的強化システムの実装

📋 5-1. フェイズカードの基本
   📋 SP3で場に設置
   📋 初期効果 + 3段階の強化効果
   📋 同属性カードをチャージして段階進行

📋 5-2. 段階効果の処理
   📋 チャージごとに次の段階へ
   📋 効果は上書き（前の段階は無効）
   📋 最大3枚チャージ、1ターン1枚制限

📋 5-3. 最終フェイズ処理
   📋 3枚チャージ後、第3段階発動
   📋 フェイズカードを墓地へ送る
   📋 チャージしたカードも一緒に墓地へ

進捗率: 0% 📋
備考: データ構造は準備済みだが、ゲームロジック未実装。

================================================================================
【未着手】Phase 6: 効果エンジン実装
================================================================================
優先度: ★★☆（中）
目的: カード効果の自動処理

📋 6-1. トリガー効果
   🚧 召喚時効果 ← 簡易実装（ログ出力のみ）
   📋 破壊時効果
   📋 バトルフェイズ開始時効果
   📋 ターン終了時効果

📋 6-2. 効果の種類
   🚧 ダメージ（単体/全体/プレイヤー） ← 簡易実装
   🚧 回復（HP/ライフ） ← 簡易実装
   📋 バフ/デバフ（攻撃力/HP増減）
   📋 サーチ（デッキから手札へ）
   📋 蘇生（墓地から場へ）
   📋 破壊（モンスター/カード）
   📋 コントロール奪取

📋 6-3. 効果テキストパーサー
   🚧 正規表現による効果抽出 ← 簡易実装
   🚧 数値パラメータの取得 ← 簡易実装
   📋 対象選択の判定

進捗率: 20% 📋
備考: 基本的なダメージ・回復効果のみ実装。

================================================================================
【未着手】Phase 7: AI対戦モード
================================================================================
優先度: ★☆☆（低〜中）
目的: 1人でもプレイ可能にする

📋 7-1. 基本AI
   📋 ランダムカード選択
   📋 コストに応じた召喚判断
   📋 攻撃可能なら攻撃

📋 7-2. 中級AI
   📋 属性相性の考慮
   📋 有利な攻撃対象の選択
   📋 魔法カードの適切な使用

📋 7-3. 上級AI（将来）
   📋 デッキシナジーの理解
   📋 複数ターン先の計画
   📋 相手の手札予測

進捗率: 0% 📋

================================================================================
【未着手】Phase 8: デッキ構築
================================================================================
優先度: ★☆☆（低）
目的: カスタムデッキでの対戦

📋 8-1. デッキ構築画面
   📋 全カードリスト表示
   📋 フィルター（属性、コスト、種類）
   📋 検索機能

📋 8-2. デッキルールの適用
   ✅ 40枚固定 ← ランダムデッキ生成で実装済み
   ✅ 同一カード3枚まで ← ランダムデッキ生成で実装済み
   ✅ 禁忌カード1枚まで ← ランダムデッキ生成で実装済み

📋 8-3. デッキ保存/読み込み
   📋 ローカルストレージへの保存
   📋 プリセットデッキ

進捗率: 30% 📋
備考: デッキルールは実装済みだが、UI未実装。

================================================================================
【未着手】Phase 9: UI/UX改善
================================================================================
優先度: ★☆☆（低）
目的: より遊びやすく、見やすく

🚧 9-1. カードデザイン改善
   📋 カードイラスト表示エリア
   ✅ 属性アイコン（色彩グラデーション）
   📋 レアリティ表示

📋 9-2. アニメーション追加
   📋 カード召喚エフェクト
   📋 攻撃エフェクト
   ✅ ダメージ表示（ログ）

📋 9-3. サウンド（将来）
   📋 BGM
   📋 効果音

📋 9-4. レスポンシブ対応
   📋 モバイル対応
   📋 画面サイズ調整

進捗率: 20% 📋

================================================================================
【全体進捗サマリー】
================================================================================

Phase 1: プロトタイプ              ✅ 100% 完了
Phase 2: カードデータ完全実装      ✅ 95%  完了
Phase 3: 技システム実装            🚧 60%  実装中
Phase 4: キーワード能力実装        📋 10%  未着手
Phase 5: フェイズカード実装        📋 0%   未着手
Phase 6: 効果エンジン実装          📋 20%  未着手
Phase 7: AI対戦モード              📋 0%   未着手
Phase 8: デッキ構築                📋 30%  未着手
Phase 9: UI/UX改善                 📋 20%  未着手

総合進捗: 約40%

================================================================================
【現在の実装における強み】
================================================================================

✅ 完全なCSVパーサー
   - 433枚のカードデータを正しく読み込み
   - 複雑な引用符やエスケープ処理に対応
   - 技情報の自動抽出

✅ 堅牢な基本ゲームシステム
   - SPトークン管理
   - フェイズ進行
   - 基本的な戦闘システム
   - ライフポイント管理

✅ 良好なUI/UX
   - 視覚的に分かりやすいカード表示
   - フェイズインジケーター
   - ゲームログ
   - 選択カード詳細パネル
   - 技アイコン表示

✅ チャージシステムの基盤
   - チャージ機能の実装
   - 技発動UIの実装
   - 属性・枚数チェック

================================================================================
【現在の実装における課題】
================================================================================

⚠️ 技効果の実装が不完全
   - ダメージと回復のみ実装
   - バフ/デバフ、サーチ、蘇生、破壊等が未実装
   - 多くのカードが本来の効果を発揮できない

⚠️ キーワード能力が機能しない
   - データとしては存在するが、ゲームロジックが未実装
   - 【覚醒】【刹那詠唱】【死触】等が動作しない

⚠️ フェイズカードが使用不可
   - データ構造は対応済みだが、ゲームロジック未実装

⚠️ デッキ構築UIがない
   - ランダムデッキのみ
   - カスタムデッキが組めない

⚠️ AI対戦がない
   - 2人プレイのみ
   - 1人での練習ができない

================================================================================
【推奨開発順序（更新版）】
================================================================================

次のステップ:

1. 【最優先】Phase 3完了: 技効果の拡張
   - バフ/デバフの実装
   - サーチ、蘇生、破壊等の実装
   - より多くのカードが本来の効果を発揮できるようになる

2. Phase 4: キーワード能力の実装
   - 【刹那詠唱】の実装（魔法カードの相手ターン発動）
   - 【覚醒】の実装（条件トリガー）
   - 状態異常システムの基盤

3. Phase 5: フェイズカード実装
   - 段階的強化の仕組み
   - チャージシステムとの連携

4. Phase 6: 効果エンジンの完成
   - トリガー効果の充実
   - より複雑な効果の実装

5. Phase 8: デッキ構築UI
   - カード選択画面
   - デッキ保存/読み込み

6. Phase 7: AI対戦モード
   - 基本AI実装
   - 1人プレイ可能に

7. Phase 9: UI/UX改善
   - アニメーション
   - カードイラスト
   - モバイル対応

================================================================================
【技術的な改善点】
================================================================================

現在のコードの良い点:
✅ Reactのhooksを適切に使用
✅ 状態管理が明確
✅ カードの一意性を保証（uniqueId）
✅ エラーハンドリングが適切
✅ CSVパーサーが堅牢

改善が必要な点:
⚠️ 効果エンジンのアーキテクチャが未設計
   → 各効果を関数として定義し、効果名から実行する仕組みが必要

⚠️ 技効果の解釈が簡易的
   → より複雑なパターンマッチングとパラメータ抽出が必要

⚠️ useCallbackの依存配列に改善の余地
   → 一部の関数で依存関係が不完全

⚠️ フィールド更新ロジックが冗長
   → ヘルパー関数でリファクタリング可能

推奨リファクタリング:
1. 効果実行エンジンの分離（effectEngine.js）
2. カードデータ管理の分離（cardManager.js）
3. バトルロジックの分離（battleSystem.js）
4. UIコンポーネントの分離（components/）

================================================================================
【参照ファイル】
================================================================================
- ルール仕様書: /mnt/project/マジックスピリット_公式ルール仕様書_ver2_11.txt
- フェイズカードルール: /mnt/project/マジックスピリット_-_フェイズカードルール__ver1_0_.txt
- 技発動ルール: /mnt/project/マジックスピリット_-_属性カードをエネルギーとする技発動ルール__ver1_1_.txt
- カードリスト: /mnt/project/cardlist.csv
- 現在の実装: src/magic-spirit.jsx

================================================================================
【結論】
================================================================================

現在の実装は、基本的なゲームシステムとカードデータの読み込みが完了し、
チャージと技発動の基盤も実装されています。

しかし、技効果やキーワード能力の実装が不完全なため、多くのカードが
本来の効果を発揮できません。

次の優先事項は「Phase 3の完了」であり、技効果のパーサーと実行エンジンを
拡張することで、ゲームの戦略性と面白さが大幅に向上します。

総合評価: 堅実な基盤構築が完了。次は効果システムの充実が鍵。

================================================================================
