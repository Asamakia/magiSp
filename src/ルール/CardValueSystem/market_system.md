# マジックスピリット 動的市場システム

作成日: 2025年11月28日

## 概要

カードの価値が常に変動する擬似市場システム。
プレイヤーには見えない「他のトレーダーたち」が市場で売買している設定で、ニュースや出来事により相場が変動する。

```
最終価値 = 基礎価値 × レアリティ倍率 × 市場変動
```

---

## 時間の流れ

```
1戦 = ゲーム内1日
7戦 = ゲーム内1週間
```

---

## 変動要素（3層構造）

### 1. デイリーニュース

| 項目 | 内容 |
|------|------|
| 発生 | 毎戦（1日ごと） |
| 変動幅 | ±15%〜50% |
| 効果 | 特定の属性/カテゴリ/ティア等に影響 |
| パターン | テンプレート自動生成（数千通り） |

### 2. 週間トレンド

| 項目 | 内容 |
|------|------|
| 発生 | 7戦ごとに切り替え |
| 変動幅 | ±15%〜25% |
| 効果 | 属性やテーマ全体に緩やかな影響 |
| パターン | 固定15種 |

### 3. 突発イベント

| 項目 | 内容 |
|------|------|
| 発生 | 10%の確率（約10戦に1回） |
| 変動幅 | ±30%〜60% |
| 効果 | 大きな市場変動 |
| パターン | 固定25種 |

---

## 変動の重ね掛け

```
例: 禁忌の鴉王ミラン UR（ベース19,575G）

週間トレンド「未来属性」: +20%
デイリー「禁忌研究ブーム」: +35%
突発イベントなし
─────────────────
合計: +55%
→ 19,575 × 1.55 = 30,341G
```

### 上限設定

| 方向 | 上限 |
|------|------|
| 上昇 | +100%（最大2倍） |
| 下落 | -50%（最低半額） |

---

## デイリーニュース テンプレートシステム

### テンプレートパターン（8種）

#### パターン1: 基本型
```
「【属性】属性の【カテゴリ】が【理由】により【方向】！」

例: 「炎属性の岩狸が大会優勝により高騰！」
```

#### パターン2: 人物型
```
「【人物】が【カテゴリ】を【行動】！【方向】の兆し」

例: 「有名コレクターが粘液獣を買い占め！高騰の兆し」
例: 「研究者がゴーレムを酷評！下落の兆し」
```

#### パターン3: 場所型
```
「【場所】で【出来事】発生、【対象】に影響」

例: 「魔女の森で異変発生、闇属性に影響」
例: 「炎の火山で噴火、炎属性カードに影響」
```

#### パターン4: 噂型
```
「『【噂の内容】』との噂が広まり【対象】が【方向】」

例: 「『禁忌カードが規制される』との噂が広まり禁忌が下落」
例: 「『次の環境は水が強い』との噂が広まり水属性が高騰」
```

#### パターン5: 比較型
```
「【対象A】より【対象B】が注目され、明暗分かれる」

例: 「炎属性より水属性が注目され、明暗分かれる」
例: 「高コストより低コストが注目され、明暗分かれる」
```

#### パターン6: 需要供給型
```
「【対象】の【需要/供給】が【増減】、価格に影響」

例: 「URカードの需要が急増、価格に影響」
例: 「Dティアの供給が過多、価格に影響」
```

#### パターン7: 時事ネタ型
```
「【季節/時間】の影響で【対象】に注目集まる」

例: 「夏の影響で炎属性に注目集まる」
例: 「夜の影響で闇属性に注目集まる」
```

#### パターン8: ストーリー型（世界観連動）
```
「【キャラ/勢力】の動向により【対象】が【方向】」

例: 「ヴェルゼファールの目撃情報により水属性が高騰」
例: 「魔女エリザヴェットの封印が緩み闇属性が高騰」
```

---

## 変数リスト

### 属性（7種）

```
炎 / 水 / 光 / 闇 / 原始 / 未来 / 無
```

### カテゴリ（20種+）と所属属性

| カテゴリ | 所属属性 |
|----------|----------|
| 岩狸 | 炎 |
| ドラゴン | 炎 |
| フェニックス | 炎/光 |
| ブリザードキャット | 水 |
| ヴェルゼファール | 水 |
| リヴァイアサン | 水 |
| 鳥民 | 光 |
| フルーツ・マリオネット | 光 |
| リリカ | 光/闇 |
| 魔女 | 闇 |
| ゴシック | 闘/原始 |
| シャドウ | 闇 |
| 黒呪 | 闇 |
| 粘液獣 | 原始 |
| 鎖縛 | 原始 |
| ゴーレム | 未来 |
| 未来鴉 | 未来 |
| 虹羽密林 | 複数 |
| 呪術狩り | 複数 |
| ヴォランティス | 複数 |
| 鉄槍騎士団 | なし |

※基本型パターンでは、カテゴリを選んだら属性は自動決定される

### 人物（15種）

汎用的な人物なので、どのカテゴリ/属性とも組み合わせ可能。

```
有名コレクター / 研究者 / 大会優勝者 / 
闇商人 / 鑑定士 / 投資家 / 古参トレーダー /
新規参入者 / ギルドマスター / 王宮関係者 /
カード職人 / 密輸業者 / 占い師 / 
引退した冒険者 / 謎の旅人
```

### 場所と関連する対象・出来事

| 場所 | 関連属性 | 関連カテゴリ | 関連出来事 |
|------|----------|-------------|-----------|
| 炎の火山 | 炎 | 岩狸、ドラゴン | 噴火、地震、発掘 |
| 深海 | 水 | ヴェルゼファール、リヴァイアサン | 海流変化、発見、沈没 |
| 氷結宮殿 | 水 | ブリザードキャット | 吹雪、凍結、解凍 |
| 魔女の森 | 闇 | 魔女、ゴシック | 異変、呪い、儀式 |
| 闇市場 | 闇 | シャドウ、黒呪 | 摘発、取引、密輸 |
| 時空の狭間 | 未来 | ゴーレム、未来鴉 | 時空歪み、出現、消失 |
| 粘液の沼地 | 原始 | 粘液獣 | 繁殖、変異、発見 |
| 鳥民の島 | 光 | 鳥民 | 祭典、移住、嵐 |
| 古代遺跡 | 原始/闇 | ゴシック、禁忌 | 発掘、封印、崩壊 |
| 王都 | なし | 全般 | 布告、祭典、事件 |
| 学術都市 | 未来/光 | ゴーレム、研究系 | 研究発表、発明、論争 |
| 辺境の村 | 原始 | 粘液獣、鎖縛 | 目撃、被害、救援 |
| 海賊の港 | 水 | リヴァイアサン | 密輸、嵐、沈没 |
| 商人ギルド | なし | 全般 | 相場操作、規制、開放 |
| 禁忌の塔 | 闇 | 禁忌 | 封印解除、異変、調査 |

### 季節/時間と関連する対象

| 季節/時間 | 関連属性 | 理由 |
|-----------|----------|------|
| 春 | 光、原始 | 芽吹き、再生 |
| 夏 | 炎、水 | 暑さ、海 |
| 秋 | 闇、原始 | 枯れ、収穫 |
| 冬 | 水、闇 | 氷、長夜 |
| 朝 | 光 | 日の出 |
| 昼 | 炎、光 | 太陽 |
| 夕 | 炎 | 夕焼け |
| 夜 | 闇、未来 | 闇、星 |

### 噂の内容と関連する対象

| 噂の種類 | 関連対象 | 方向 |
|----------|----------|------|
| 規制の噂 | 禁忌カード | 下落 |
| 強化の噂 | 特定属性（ランダム） | 上昇 |
| 弱体化の噂 | 特定属性（ランダム） | 下落 |
| 再録の噂 | 特定カテゴリ | 下落 |
| 絶版の噂 | 特定カテゴリ | 上昇 |
| 新カードの噂 | 特定属性 | 上昇 |
| 大会メタの噂 | 特定属性/カテゴリ | 上昇 |
| 不正発覚の噂 | 高レアリティ | 下落 |
| コンボ発見の噂 | 特定カテゴリ | 上昇 |

### キャラ/勢力と関連する対象

| キャラ/勢力 | 関連属性 | 関連カテゴリ |
|-------------|----------|-------------|
| ヴェルゼファール | 水 | ヴェルゼファール、リヴァイアサン |
| 魔女エリザヴェット | 闇 | 魔女、黒呪、ゴシック |
| 岩狸一族 | 炎 | 岩狸 |
| ブリザードマスター | 水 | ブリザードキャット |
| 鉄槍騎士団 | なし | 鉄槍騎士団 |
| 鳥民の長老 | 光 | 鳥民 |
| 禁忌の鴉王ミラン | 未来 | 未来鴉、禁忌 |
| 幼魔王女リリカ | 光/闇 | リリカ |
| 粘液獣の女王 | 原始 | 粘液獣 |
| ゴシック姫 | 原始 | ゴシック、鎖縛 |
| ヴォランティス | 複数 | ヴォランティス |
| 呪術狩りギルド | 複数 | 呪術狩り |
| 虹羽の守護者 | 複数 | 虹羽密林 |
| 時の賢者 | 未来 | ゴーレム、未来鴉 |
| 炎竜母フレイマ | 炎 | ドラゴン、フェニックス |

### 理由（30種）

汎用的な理由なので、どの対象とも組み合わせ可能。

```
大会優勝 / 研究発表 / 噂話 / 新発見 / 
規制議論 / 偽物騒動 / 買い占め / 在庫処分 /
環境変化 / 新カード発表 / 相性発見 / 再評価 / 
不具合報告 / コンボ開発 / 初心者人気 /
ベテラン評価 / 希少化 / 大量流出 /
歴史的発見 / 呪い騒動 / 浄化成功 /
密輸摘発 / コレクション完成 / 博物館展示 /
王室御用達 / 冒険者愛用 / 事故報告 /
神話解明 / 封印解除 / 予言成就
```

### 方向 + 強度（6種）

| 表現 | 変動幅（範囲） |
|------|---------------|
| 小幅上昇 | +10%〜20% |
| 上昇 | +20%〜40% |
| 急騰 | +40%〜60% |
| 小幅下落 | -10%〜20% |
| 下落 | -20%〜40% |
| 暴落 | -40%〜60% |

※同じ表現でも毎回範囲内でランダムに決定

---

## パターン別の紐づけルール

| パターン | 紐づけ | 説明 |
|----------|--------|------|
| 1. 基本型 | カテゴリ→属性 | カテゴリを選んだら属性は自動決定 |
| 2. 人物型 | なし | 汎用人物なので自由 |
| 3. 場所型 | 場所→対象、場所→出来事 | 場所に関連する対象・出来事のみ |
| 4. 噂型 | 噂内容→対象 | 噂の種類に合った対象のみ |
| 5. 比較型 | なし | 比較なので自由 |
| 6. 需要供給型 | なし | 単体の話なので自由 |
| 7. 時事ネタ型 | 季節/時間→対象 | 季節/時間に合った属性のみ |
| 8. ストーリー型 | キャラ→対象 | キャラに関連する対象のみ |

---

## 組み合わせ数

```
パターン8種 × 属性7種 × カテゴリ20種 × 強度6種
= 6,720パターン（最低）

さらに理由・人物・場所の組み合わせで
数万パターン以上
```

---

## 週間トレンド（固定15種）

| No | トレンド | 効果 |
|----|----------|------|
| 1 | 炎属性の時代 | 炎 +20%、水 -10% |
| 2 | 水属性の時代 | 水 +20%、炎 -10% |
| 3 | 光属性の時代 | 光 +20%、闇 -10% |
| 4 | 闇属性の時代 | 闇 +20%、光 -10% |
| 5 | 原始属性の時代 | 原始 +20% |
| 6 | 未来属性の時代 | 未来 +20% |
| 7 | 無属性の時代 | 無 +25% |
| 8 | 低コスト環境 | コスト3以下 +15% |
| 9 | 高コスト環境 | コスト6以上 +15% |
| 10 | レア志向 | SR以上 +20% |
| 11 | 堅実志向 | B〜Cティア +15% |
| 12 | 禁忌ブーム | 禁忌カード +25% |
| 13 | 好況 | 全体 +10% |
| 14 | 不況 | 全体 -10% |
| 15 | 混沌 | ランダムに変動 |

---

## 突発イベント（固定25種）

### 高騰系（10種）

| イベント | 効果 |
|----------|------|
| コレクター大量買い | UR以上 +50% |
| 大会メタ激変 | ランダム属性 +60% |
| 古文書発見 | 禁忌カード +40% |
| 王室コレクション公開 | Sティア +45% |
| 偽物大量摘発 | 全体 +15%（本物需要） |
| 新コンボ発見 | ランダムカテゴリ +55% |
| 伝説のトレーダー参入 | 高レア +35% |
| 記念日セール | 特定属性 +40% |
| 博物館買い付け | Aティア以上 +30% |
| 冒険者ギルド推奨 | ランダムカテゴリ +50% |

### 暴落系（8種）

| イベント | 効果 |
|----------|------|
| 偽物騒動 | ランダムカテゴリ -40% |
| 大量在庫放出 | Dティア -35% |
| 規制の噂 | 禁忌カード -30% |
| トレーダー引退売り | 特定属性 -45% |
| 不吉な予言 | 闇属性以外 -20% |
| 市場パニック | 全体 -25% |
| 密輸船沈没 | ランダム属性 -35% |
| 評価見直し | 高ティア -20% |

### 特殊系（7種）

| イベント | 効果 |
|----------|------|
| 属性シャッフル | 全属性の変動が入れ替わり |
| 逆転現象 | 高ティアと低ティアの変動が逆転 |
| 安定期 | 全ての変動が±5%に収束 |
| 乱高下 | 全てのカードがランダムに±30% |
| 闇市場開放 | 低レア +40%、高レア -20% |
| 黄金時代 | 全体 +30%（稀） |
| 大暴落 | 全体 -40%（稀） |

---

## UI表示例

```
┌─────────────────────────────────────┐
│ 📰 マーケットニュース               │
├─────────────────────────────────────┤
│ 📅 週間トレンド: 炎属性の時代       │
│    → 炎属性 +20% / 水属性 -10%      │
├─────────────────────────────────────┤
│ 📰 本日のニュース                   │
│ 「有名コレクターが岩狸を買い占め！  │
│   高騰の兆し」                      │
│    → [岩狸]カテゴリ +35%            │
├─────────────────────────────────────┤
│ ⚡ 突発イベント発生中！              │
│ 「古文書発見」                      │
│    → 禁忌カード +40%                │
└─────────────────────────────────────┘
```

---

## 価格変動の計算例

### 例1: 禁忌の鴉王ミラン UR

```
基礎価値: 1,305
× レアリティ(UR): ×15.0 = 19,575G

市場変動:
  週間「未来属性の時代」: +20%
  デイリー「禁忌研究ブーム」: +35%
  突発「古文書発見」: +40%
  ────────────────
  合計: +95%（上限100%内）

最終価値: 19,575 × 1.95 = 38,171G
```

### 例2: フレア・ドラゴン C

```
基礎価値: 360
× レアリティ(C): ×1.0 = 360G

市場変動:
  週間「水属性の時代」: 炎 -10%
  デイリー「ドラゴン下落」: -30%
  突発なし
  ────────────────
  合計: -40%

最終価値: 360 × 0.60 = 216G
```

---

## 実装メモ

### 変動幅の生成

```javascript
const DIRECTIONS = {
  '小幅上昇': { min: 10, max: 20 },
  '上昇':     { min: 20, max: 40 },
  '急騰':     { min: 40, max: 60 },
  '小幅下落': { min: -20, max: -10 },
  '下落':     { min: -40, max: -20 },
  '暴落':     { min: -60, max: -40 },
};

// 実際の変動値を生成
function getModifier(direction) {
  const range = DIRECTIONS[direction];
  return randomBetween(range.min, range.max);
}

// 例
getModifier('小幅上昇') → +14%
getModifier('小幅上昇') → +18%
getModifier('上昇')     → +31%
```

### ニュース生成の疑似コード

```javascript
function generateDailyNews() {
  const pattern = randomChoice(PATTERNS);
  
  switch (pattern.type) {
    case 'basic': // 基本型: カテゴリ→属性を自動決定
      const category = randomChoice(CATEGORIES);
      const attribute = category.belongsTo; // 紐づけから取得
      const reason = randomChoice(REASONS);
      const direction = randomChoice(DIRECTIONS);
      return {
        text: `${attribute}属性の${category.name}が${reason}により${direction.label}！`,
        target: { attribute, category: category.name },
        modifier: getModifier(direction)
      };
      
    case 'location': // 場所型: 場所→対象・出来事を紐づけ
      const location = randomChoice(LOCATIONS);
      const event = randomChoice(location.relatedEvents); // 紐づけから取得
      const target = randomChoice(location.relatedTargets); // 紐づけから取得
      return {
        text: `${location.name}で${event}発生、${target}に影響`,
        target: target,
        modifier: getModifier(randomChoice(DIRECTIONS))
      };
      
    case 'story': // ストーリー型: キャラ→対象を紐づけ
      const character = randomChoice(CHARACTERS);
      const relatedTarget = randomChoice(character.relatedTargets); // 紐づけから取得
      return {
        text: `${character.name}の動向により${relatedTarget}が${direction.label}`,
        target: relatedTarget,
        modifier: getModifier(direction)
      };
      
    case 'rumor': // 噂型: 噂内容→対象を紐づけ
      const rumor = randomChoice(RUMORS);
      const rumorTarget = rumor.relatedTarget; // 紐づけから取得
      return {
        text: `『${rumor.content}』との噂が広まり${rumorTarget}が${rumor.direction}`,
        target: rumorTarget,
        modifier: getModifier(rumor.direction)
      };
      
    case 'seasonal': // 時事ネタ型: 季節/時間→属性を紐づけ
      const timePeriod = randomChoice(TIME_PERIODS);
      const seasonalAttr = randomChoice(timePeriod.relatedAttributes); // 紐づけから取得
      return {
        text: `${timePeriod.name}の影響で${seasonalAttr}属性に注目集まる`,
        target: { attribute: seasonalAttr },
        modifier: getModifier(randomChoice(POSITIVE_DIRECTIONS))
      };
      
    case 'person': // 人物型: 紐づけ不要
    case 'compare': // 比較型: 紐づけ不要
    case 'supply': // 需要供給型: 紐づけ不要
      // 自由に組み合わせ可能
      break;
  }
}
```

---

## 更新履歴

| バージョン | 日付 | 変更内容 |
|------------|------|----------|
| v1.0 | 2025-11-28 | 初版作成 |
| v1.1 | 2025-11-28 | 紐づけテーブル追加、変動幅を範囲に変更 |
| v1.2 | 2025-11-28 | 価格推移チャート機能追加 |
| v1.3 | 2025-11-28 | MVP実装完了（M-1〜M-4）|

---

## 価格推移チャート

### 概要

過去の価格変動を可視化し、市場を「読む」楽しさを提供する。

### データ保持方式（オプションB）

```
保存: 基礎価値の推移のみ
表示: レアリティ価格は倍率をかけて都度計算

例: フレア・ドラゴンの履歴
  保存 → [360, 380, 400, 370, ...]（基礎価値30戦分）
  表示 → UR価格 = 基礎価値 × 15 で計算
```

### データ量

| 履歴長 | データ量 | 実プレイ期間目安 |
|--------|----------|-----------------|
| 30戦 | 110 KB | 3日分 |
| 100戦 | 365 KB | 10日分 |
| 365戦 | 1.3 MB | 1ヶ月分 |
| 1000戦 | 3.6 MB | 3ヶ月分 |

---

### チャートの種類

| 種類 | 内容 | 用途 |
|------|------|------|
| **個別カード** | 特定カードの推移 | 売買タイミング判断 |
| **属性別** | 属性全体の平均推移 | トレンド把握 |
| **カテゴリ別** | カテゴリの平均推移 | テーマ投資 |
| **ティア別** | ティア全体の推移 | 高級/低級の動向 |
| **全体指数（MSI）** | 市場全体の景気指標 | 買い時/売り時判断 |

---

### 表示要素

| 項目 | 内容 |
|------|------|
| **価格推移線** | 過去30戦の価格変動グラフ |
| **現在価格** | 今の売買価格 |
| **最高値/最安値** | 期間内のピーク |
| **変動率** | 開始時からの増減% |
| **出来事マーカー** | ニュース/イベント発生時に印 |

---

### 表示イメージ

#### 個別カードチャート

```
フレア・ドラゴン UR 価格推移（過去30戦）

  7,000G ┤                          ╭─╮
  6,500G ┤              ╭───╮ ⚡   │ │
  6,000G ┤         ╭──╯    ╰─╮  ╭─╯ ╰──
  5,500G ┤    ╭──╯     📰     ╰─╯
  5,000G ┼──╯
  4,500G ┤
         └────────────────────────────────
          30戦前                      現在

  現在価格: 6,200G（+18% from 開始時）
  最高値: 6,800G（12戦前）
  最安値: 5,000G（28戦前）
  
  📰 = デイリーニュース「炎属性高騰」
  ⚡ = 突発イベント「コレクター大量買い」
```

#### 全体指数（MSI: Magic Spirit Index）

```
マジスピ市場指数（MSI）

  12,000 ┤                    ╭───
  11,500 ┤              ╭────╯
  11,000 ┤    ╭────────╯
  10,500 ┤   │
  10,000 ┼───╯
         └────────────────────────
          30戦前              現在
          
  MSI: 11,800（好況）
  前週比: +8.2%
```

---

### プレイヤーの活用例

| チャート状況 | 判断 | 行動 |
|-------------|------|------|
| 底値圏 | 「今が買い時？」 | 安く仕入れる |
| 天井圏 | 「そろそろ売り時」 | 利益確定 |
| 急騰中 | 「乗り遅れたくない」 | 追随買い |
| 急落中 | 「どこまで下がる？」 | 様子見/ナンピン |
| MSI好況 | 「全体的に高い」 | 売り優先 |
| MSI不況 | 「全体的に安い」 | 買い優先 |

---

### データ構造

```javascript
// 価格履歴データ
const priceHistory = {
  // 個別カード（基礎価値のみ保存）
  cards: {
    'MS-F-001': [360, 380, 400, 370, ...], // 30戦分
    'MS-F-002': [250, 260, 255, 270, ...],
    // ... 433カード分
  },
  
  // 属性別平均
  attributes: {
    '炎': [340, 355, 370, 360, ...],
    '水': [350, 345, 360, 380, ...],
    // ... 7属性分
  },
  
  // カテゴリ別平均
  categories: {
    '岩狸': [320, 340, 360, 350, ...],
    '粘液獣': [280, 275, 290, 300, ...],
    // ... 21カテゴリ分
  },
  
  // ティア別平均
  tiers: {
    'S': [1000, 1050, 1100, 1080, ...],
    'A': [550, 560, 580, 570, ...],
    // ... 5ティア分
  },
  
  // 全体指数
  marketIndex: [10000, 10200, 10500, 10800, ...],
  
  // イベント履歴（マーカー用）
  events: [
    { turn: 5, type: 'daily', text: '炎属性高騰' },
    { turn: 12, type: 'sudden', text: 'コレクター大量買い' },
    // ...
  ]
};
```
