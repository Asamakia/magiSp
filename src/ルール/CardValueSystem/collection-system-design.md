# ã‚«ãƒ¼ãƒ‰ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆæ›¸

ä½œæˆæ—¥: 2025-11-28
ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 1.0

## æ¦‚è¦

ã‚«ãƒ¼ãƒ‰ã®åé›†ãƒ»ç®¡ç†ãƒ»å£²è²·ã‚’è¡Œã†ã‚·ã‚¹ãƒ†ãƒ ã€‚å¯¾æˆ¦ã‚²ãƒ¼ãƒ éƒ¨åˆ†ã¨ã¯ç‹¬ç«‹ã—ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦è¨­è¨ˆã™ã‚‹ã€‚

### ä¸»è¦æ©Ÿèƒ½
- ã‚«ãƒ¼ãƒ‰æ‰€æŒç®¡ç†ï¼ˆã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
- é€šè²¨ï¼ˆGï¼‰ç®¡ç†
- ãƒ‘ãƒƒã‚¯è³¼å…¥ãƒ»é–‹å°
- ã‚«ãƒ¼ãƒ‰å£²è²·
- ãƒ‡ãƒƒã‚­ç·¨æˆï¼ˆæ‰€æŒã‚«ãƒ¼ãƒ‰ã‹ã‚‰ï¼‰

### é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- `card_value_system_v2.1.md` - ã‚«ãƒ¼ãƒ‰ä¾¡å€¤è¨ˆç®—ãƒ»ãƒ¬ã‚¢ãƒªãƒ†ã‚£ãƒ»çµŒæ¸ˆã‚·ã‚¹ãƒ†ãƒ ã®ä»•æ§˜

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å…¨ä½“æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    App.js                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  gameState: 'title' | 'playing' | 'gameOver'            â”‚
â”‚           | 'collection' | 'shop' | 'deckEdit'          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  game/        â”‚ â”‚  collection/  â”‚ â”‚    decks/     â”‚
â”‚  (å¯¾æˆ¦)       â”‚ â”‚ (ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³) â”‚ â”‚  (ãƒ‡ãƒƒã‚­ç®¡ç†)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                 â”‚                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  collection/data/     â”‚
              â”‚  storage.js           â”‚
              â”‚  (localStorageæŠ½è±¡åŒ–)  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¯¾æˆ¦ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é–¢ä¿‚

| è¦³ç‚¹ | å¯¾æˆ¦ã‚·ã‚¹ãƒ†ãƒ  | ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ  |
|------|-------------|-------------------|
| çŠ¶æ…‹ç®¡ç† | Reactã‚¹ãƒ†ãƒ¼ãƒˆï¼ˆæ®ç™ºï¼‰ | localStorageï¼ˆæ°¸ç¶šï¼‰ |
| ãƒ‡ãƒ¼ã‚¿ | ã‚«ãƒ¼ãƒ‰ãƒã‚¹ã‚¿ãƒ¼å‚ç…§ | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å›ºæœ‰ãƒ‡ãƒ¼ã‚¿ |
| é€£æºç‚¹ | å¯¾æˆ¦çµ‚äº†æ™‚ã®å ±é…¬ä»˜ä¸ | ãƒ‡ãƒƒã‚­é¸æŠæ™‚ã®ãƒ¬ã‚¢ãƒªãƒ†ã‚£é©ç”¨ |

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

### å®Ÿè£…æ¸ˆã¿æ§‹æˆ

```
src/
â”œâ”€â”€ collection/                    # ã‚«ãƒ¼ãƒ‰ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ 
â”‚   â”œâ”€â”€ index.js                   # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”‚   â”‚
â”‚   â”œâ”€â”€ data/                      # ãƒ‡ãƒ¼ã‚¿ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ storage.js             # æ°¸ç¶šåŒ–ï¼ˆlocalStorageæŠ½è±¡åŒ–ï¼‰
â”‚   â”‚   â”œâ”€â”€ playerData.js          # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿æ§‹é€ å®šç¾©
â”‚   â”‚   â”œâ”€â”€ constants.js           # çµŒæ¸ˆå®šæ•°
â”‚   â”‚   â””â”€â”€ migration.js           # ãƒ‡ãƒ¼ã‚¿ç§»è¡Œï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—æ™‚ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ systems/                   # å„ã‚·ã‚¹ãƒ†ãƒ 
â”‚   â”‚   â”œâ”€â”€ valueCalculator.js     # åŸºç¤ä¾¡å€¤è¨ˆç®—
â”‚   â”‚   â”œâ”€â”€ raritySystem.js        # ãƒ¬ã‚¢ãƒªãƒ†ã‚£å®šç¾©ãƒ»æ’å‡ºç‡
â”‚   â”‚   â”œâ”€â”€ collectionManager.js   # æ‰€æŒã‚«ãƒ¼ãƒ‰ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ currencyManager.js     # é€šè²¨ï¼ˆGï¼‰ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ packSystem.js          # ãƒ‘ãƒƒã‚¯é–‹å°
â”‚   â”‚   â””â”€â”€ shopSystem.js          # å£²è²·
â”‚   â”‚
â”‚   â””â”€â”€ components/                # ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³UI
â”‚       â”œâ”€â”€ CollectionScreen.jsx   # ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ç”»é¢
â”‚       â”œâ”€â”€ ShopScreen.jsx         # ã‚·ãƒ§ãƒƒãƒ—ç”»é¢
â”‚       â”œâ”€â”€ PackOpening.jsx        # ãƒ‘ãƒƒã‚¯é–‹å°æ¼”å‡º
â”‚       â”œâ”€â”€ CardGrid.jsx           # ã‚«ãƒ¼ãƒ‰ä¸€è¦§ã‚°ãƒªãƒƒãƒ‰
â”‚       â”œâ”€â”€ CardDetail.jsx         # ã‚«ãƒ¼ãƒ‰è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«
â”‚       â”œâ”€â”€ DeckList.jsx           # ãƒ‡ãƒƒã‚­ä¸€è¦§ãƒ»ç®¡ç†
â”‚       â””â”€â”€ DeckBuilder.jsx        # ãƒ‡ãƒƒã‚­æ§‹ç¯‰ãƒ»ç·¨é›†
â”‚
â”œâ”€â”€ magic-spirit.jsx               # ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå¯¾æˆ¦+UIçµ±åˆï¼‰
â”œâ”€â”€ engine/                        # å¯¾æˆ¦ã‚¨ãƒ³ã‚¸ãƒ³
â”œâ”€â”€ components/                    # å¯¾æˆ¦UI
â”œâ”€â”€ decks/                         # ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ‡ãƒƒã‚­
â”‚   â””â”€â”€ prebuiltDecks.js
â”œâ”€â”€ utils/                         # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â””â”€â”€ styles/                        # ã‚¹ã‚¿ã‚¤ãƒ«
```

### å°†æ¥ã®æ¤œè¨äº‹é …

```
# ä»¥ä¸‹ã¯å°†æ¥ã®æ‹¡å¼µã§æ¤œè¨
src/
â”œâ”€â”€ game/                          # å¯¾æˆ¦ã‚²ãƒ¼ãƒ ï¼ˆsrc/ç›´ä¸‹ã‹ã‚‰ç§»å‹•ï¼‰
â”‚   â”œâ”€â”€ magic-spirit.jsx
â”‚   â”œâ”€â”€ engine/
â”‚   â””â”€â”€ components/
â”‚
â”œâ”€â”€ decks/
â”‚   â””â”€â”€ userDecks.js               # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆãƒ‡ãƒƒã‚­å°‚ç”¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚
â””â”€â”€ shared/
    â””â”€â”€ hooks/
        â””â”€â”€ usePlayerData.js       # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿ç”¨ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
```

---

## ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆplayerDataï¼‰

```javascript
{
  // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ï¼‰
  version: 1,

  // é€šè²¨
  gold: 10000,

  // æ‰€æŒã‚«ãƒ¼ãƒ‰
  // åŒã˜ã‚«ãƒ¼ãƒ‰ã§ã‚‚ãƒ¬ã‚¢ãƒªãƒ†ã‚£é•ã„ã¯åˆ¥ã‚¨ãƒ³ãƒˆãƒª
  collection: [
    { cardId: "C0000021", rarity: "C", quantity: 3 },
    { cardId: "C0000021", rarity: "SR", quantity: 1 },
    { cardId: "C0000023", rarity: "R", quantity: 2 },
  ],

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆãƒ‡ãƒƒã‚­
  userDecks: [
    {
      id: "deck_001",
      name: "ç‚ãƒ‰ãƒ©ã‚´ãƒ³",
      cards: [
        { cardId: "C0000021", rarity: "SR" },
        { cardId: "C0000021", rarity: "C" },
        // ... 40æš
      ],
      createdAt: 1732780800000,
      updatedAt: 1732780800000,
    }
  ],

  // çµ±è¨ˆ
  stats: {
    totalBattles: 0,
    wins: 0,
    packsOpened: 0,
    totalGoldEarned: 0,
    totalGoldSpent: 0,
  },

  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  createdAt: 1732780800000,
  updatedAt: 1732780800000,
}
```

### æ‰€æŒã‚«ãƒ¼ãƒ‰ã‚¨ãƒ³ãƒˆãƒª

```javascript
{
  cardId: "C0000021",  // ã‚«ãƒ¼ãƒ‰ãƒã‚¹ã‚¿ãƒ¼ã®ID
  rarity: "SR",        // ãƒ¬ã‚¢ãƒªãƒ†ã‚£ï¼ˆC/UC/R/SR/UR/HR/SEC/ALT/SP/GRï¼‰
  quantity: 2,         // æ‰€æŒæšæ•°
}
```

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒƒã‚­

```javascript
{
  id: "deck_001",           // ä¸€æ„ID
  name: "ç‚ãƒ‰ãƒ©ã‚´ãƒ³",        // ãƒ‡ãƒƒã‚­å
  cards: [                  // 40æš
    { cardId: "C0000021", rarity: "SR" },
    // ...
  ],
  createdAt: 1732780800000,
  updatedAt: 1732780800000,
}
```

---

## çµŒæ¸ˆå®šæ•°

```javascript
// åˆæœŸå€¤
INITIAL_GOLD: 10000

// å¯¾æˆ¦å ±é…¬
BATTLE_REWARD_GOLD: 5000      // å¯¾æˆ¦å®Œäº†æ™‚
BATTLE_WIN_BONUS_PACKS: 1     // å‹åˆ©ãƒœãƒ¼ãƒŠã‚¹

// ãƒ‘ãƒƒã‚¯
PACK_PRICE: 3500              // 1ãƒ‘ãƒƒã‚¯ã®ä¾¡æ ¼
CARDS_PER_PACK: 5             // 1ãƒ‘ãƒƒã‚¯ã®æšæ•°
```

---

## ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã‚·ã‚¹ãƒ†ãƒ 

### ãƒ¬ã‚¢ãƒªãƒ†ã‚£ä¸€è¦§

| ãƒ¬ã‚¢ãƒªãƒ†ã‚£ | åç§° | ä¾¡å€¤å€ç‡ | å‚™è€ƒ |
|------------|------|----------|------|
| C | ã‚³ãƒ¢ãƒ³ | Ã—1.0 | æ¯ãƒ‘ãƒƒã‚¯2-3æš |
| UC | ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³ | Ã—1.3 | æ¯ãƒ‘ãƒƒã‚¯1æš |
| R | ãƒ¬ã‚¢ | Ã—2.0 | 1-2ãƒ‘ãƒƒã‚¯ |
| SR | ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¬ã‚¢ | Ã—5.0 | 5-6ãƒ‘ãƒƒã‚¯ |
| UR | ã‚¦ãƒ«ãƒˆãƒ©ãƒ¬ã‚¢ | Ã—15.0 | 20ãƒ‘ãƒƒã‚¯ï¼ˆ1ç®±ï¼‰ |
| HR | ãƒ›ãƒ­ã‚°ãƒ©ãƒ  | Ã—30.0 | 80ãƒ‘ãƒƒã‚¯ï¼ˆ4ç®±ï¼‰ |
| SEC | ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ | Ã—50.0 | 200ãƒ‘ãƒƒã‚¯ |
| ALT | ã‚ªãƒ«ã‚¿ãƒŠãƒ†ã‚£ãƒ– | Ã—50.0 | 500ãƒ‘ãƒƒã‚¯ |
| SP | ã‚¹ãƒšã‚·ãƒ£ãƒ« | Ã—60.0 | 1,250ãƒ‘ãƒƒã‚¯ |
| GR | ã‚´ãƒƒãƒ‰ãƒ¬ã‚¢ | Ã—100.0 | ç¦å¿Œã‚«ãƒ¼ãƒ‰å°‚ç”¨ |

### ãƒ†ã‚£ã‚¢åˆ¥ãƒ¬ã‚¢ãƒªãƒ†ã‚£åˆ¶é™

| ãƒ†ã‚£ã‚¢ | å‡ºç¾ãƒ¬ã‚¢ãƒªãƒ†ã‚£ | æœ€ä½ãƒ¬ã‚¢ |
|--------|----------------|----------|
| S | R / SR / UR / HR / SEC / ALT / SP / GRâ€» | R |
| A | UC / R / SR / UR / HR / SEC / ALT / SP | UC |
| Bã€œD | C / UC / R / SR / UR / HR / SEC / ALT / SP | C |

â€»GRã¯ç¦å¿Œã‚«ãƒ¼ãƒ‰å°‚ç”¨

### ãƒ‘ãƒƒã‚¯æ§‹æˆï¼ˆ1ãƒ‘ãƒƒã‚¯5æšï¼‰

```
æ 1: Cç¢ºå®š
æ 2: Cç¢ºå®š
æ 3: C/UCï¼ˆUC 30%ï¼‰
æ 4: C/UCï¼ˆUC 30%ï¼‰
æ 5: Rä»¥ä¸Šç¢ºå®šæ 
```

### æ 5ï¼ˆRä»¥ä¸Šç¢ºå®šæ ï¼‰ã®æ’å‡ºç‡

| ãƒ¬ã‚¢ | ç¢ºç‡ |
|------|------|
| R | 75% |
| SR | 18% |
| UR | 5% |
| HR | 1.2% |
| SEC | 0.5% |
| ALT | 0.2% |
| SP | 0.08% |
| GR | 0.02% |

---

## ã‚·ã‚¹ãƒ†ãƒ è©³ç´°

### storage.js - æ°¸ç¶šåŒ–æŠ½è±¡ãƒ¬ã‚¤ãƒ¤ãƒ¼

å°†æ¥ã®ç§»è¡Œï¼ˆIndexedDBã€ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸç­‰ï¼‰ã‚’å®¹æ˜“ã«ã™ã‚‹ãŸã‚ã®æŠ½è±¡åŒ–ã€‚

```javascript
const STORAGE_VERSION = 1;
const STORAGE_KEY = 'magicSpirit_playerData';

export const storage = {
  // ä¿å­˜
  save: (data) => {
    const wrapped = {
      version: STORAGE_VERSION,
      data,
      updatedAt: Date.now(),
    };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(wrapped));
  },

  // èª­ã¿è¾¼ã¿
  load: () => {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return null;
    const { version, data } = JSON.parse(raw);
    // ãƒãƒ¼ã‚¸ãƒ§ãƒ³é•ã„ãŒã‚ã‚Œã°migrationå‡¦ç†ã‚’å‘¼ã³å‡ºã—
    if (version < STORAGE_VERSION) {
      return migrate(data, version);
    }
    return data;
  },

  // å‰Šé™¤
  clear: () => localStorage.removeItem(STORAGE_KEY),

  // å­˜åœ¨ç¢ºèª
  exists: () => localStorage.getItem(STORAGE_KEY) !== null,

  // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç”¨ï¼‰
  export: () => localStorage.getItem(STORAGE_KEY),

  // ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆå¾©å…ƒç”¨ï¼‰
  import: (jsonString) => {
    localStorage.setItem(STORAGE_KEY, jsonString);
  },
};
```

### collectionManager.js - æ‰€æŒã‚«ãƒ¼ãƒ‰ç®¡ç†

```javascript
export const collectionManager = {
  // ã‚«ãƒ¼ãƒ‰è¿½åŠ ï¼ˆãƒ‘ãƒƒã‚¯é–‹å°ã€å ±é…¬ç­‰ï¼‰
  addCard: (playerData, cardId, rarity) => {
    const collection = [...playerData.collection];
    const existing = collection.find(
      c => c.cardId === cardId && c.rarity === rarity
    );

    if (existing) {
      existing.quantity += 1;
    } else {
      collection.push({ cardId, rarity, quantity: 1 });
    }

    return { ...playerData, collection };
  },

  // ã‚«ãƒ¼ãƒ‰å‰Šé™¤ï¼ˆå£²å´ï¼‰
  removeCard: (playerData, cardId, rarity, quantity = 1) => {
    const collection = [...playerData.collection];
    const index = collection.findIndex(
      c => c.cardId === cardId && c.rarity === rarity
    );

    if (index === -1) return playerData;

    collection[index].quantity -= quantity;
    if (collection[index].quantity <= 0) {
      collection.splice(index, 1);
    }

    return { ...playerData, collection };
  },

  // æ‰€æŒç¢ºèª
  hasCard: (playerData, cardId, rarity = null) => {
    if (rarity) {
      return playerData.collection.some(
        c => c.cardId === cardId && c.rarity === rarity && c.quantity > 0
      );
    }
    return playerData.collection.some(
      c => c.cardId === cardId && c.quantity > 0
    );
  },

  // ç‰¹å®šã‚«ãƒ¼ãƒ‰ã®æ‰€æŒæšæ•°
  getQuantity: (playerData, cardId, rarity) => {
    const entry = playerData.collection.find(
      c => c.cardId === cardId && c.rarity === rarity
    );
    return entry ? entry.quantity : 0;
  },

  // ç‰¹å®šã‚«ãƒ¼ãƒ‰ã®æ‰€æŒãƒ¬ã‚¢ãƒªãƒ†ã‚£ä¸€è¦§
  getOwnedRarities: (playerData, cardId) => {
    return playerData.collection
      .filter(c => c.cardId === cardId && c.quantity > 0)
      .map(c => c.rarity);
  },

  // æœ€é«˜ãƒ¬ã‚¢ãƒªãƒ†ã‚£å–å¾—ï¼ˆãƒ—ãƒªã‚»ãƒƒãƒˆãƒ‡ãƒƒã‚­ç”¨ï¼‰
  getHighestRarity: (playerData, cardId) => {
    const owned = collectionManager.getOwnedRarities(playerData, cardId);
    if (owned.length === 0) return 'C'; // æœªæ‰€æŒã¯Cæ‰±ã„

    const rarityOrder = ['GR', 'SP', 'ALT', 'SEC', 'HR', 'UR', 'SR', 'R', 'UC', 'C'];
    for (const rarity of rarityOrder) {
      if (owned.includes(rarity)) return rarity;
    }
    return 'C';
  },

  // å…¨æ‰€æŒã‚«ãƒ¼ãƒ‰æ•°
  getTotalCards: (playerData) => {
    return playerData.collection.reduce((sum, c) => sum + c.quantity, 0);
  },

  // ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚«ãƒ¼ãƒ‰æ•°ï¼ˆãƒ¬ã‚¢ãƒªãƒ†ã‚£å•ã‚ãšï¼‰
  getUniqueCardCount: (playerData) => {
    const uniqueIds = new Set(playerData.collection.map(c => c.cardId));
    return uniqueIds.size;
  },
};
```

### packSystem.js - ãƒ‘ãƒƒã‚¯é–‹å°

```javascript
import { ECONOMY } from '../data/constants';
import { raritySystem } from './raritySystem';

export const packSystem = {
  // ãƒ‘ãƒƒã‚¯è³¼å…¥å¯èƒ½ã‹
  canBuyPack: (playerData) => {
    return playerData.gold >= ECONOMY.PACK_PRICE;
  },

  // ãƒ‘ãƒƒã‚¯é–‹å°ï¼ˆ5æšæŠ½é¸ï¼‰
  openPack: (allCards, cardValues) => {
    const results = [];

    // æ 1-2: Cç¢ºå®š
    results.push(drawCard(allCards, cardValues, 'C_ONLY'));
    results.push(drawCard(allCards, cardValues, 'C_ONLY'));

    // æ 3-4: C/UCï¼ˆUC 30%ï¼‰
    results.push(drawCard(allCards, cardValues, 'C_UC'));
    results.push(drawCard(allCards, cardValues, 'C_UC'));

    // æ 5: Rä»¥ä¸Šç¢ºå®š
    results.push(drawCard(allCards, cardValues, 'R_PLUS'));

    return results;
  },

  // ãƒ‘ãƒƒã‚¯è³¼å…¥å‡¦ç†ï¼ˆGæ¶ˆè²» + é–‹å°ï¼‰
  buyAndOpenPack: (playerData, allCards, cardValues) => {
    if (!packSystem.canBuyPack(playerData)) {
      return { success: false, error: 'ã‚´ãƒ¼ãƒ«ãƒ‰ãŒè¶³ã‚Šã¾ã›ã‚“' };
    }

    let newData = {
      ...playerData,
      gold: playerData.gold - ECONOMY.PACK_PRICE,
      stats: {
        ...playerData.stats,
        packsOpened: playerData.stats.packsOpened + 1,
        totalGoldSpent: playerData.stats.totalGoldSpent + ECONOMY.PACK_PRICE,
      },
    };

    const cards = packSystem.openPack(allCards, cardValues);

    // å„ã‚«ãƒ¼ãƒ‰ã‚’ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«è¿½åŠ 
    for (const { cardId, rarity } of cards) {
      newData = collectionManager.addCard(newData, cardId, rarity);
    }

    return { success: true, cards, playerData: newData };
  },
};

// å†…éƒ¨é–¢æ•°ï¼šã‚«ãƒ¼ãƒ‰æŠ½é¸
function drawCard(allCards, cardValues, slotType) {
  // 1. ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã‚’æ±ºå®š
  const rarity = raritySystem.drawRarity(slotType);

  // 2. ãã®ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã§å‡ºç¾å¯èƒ½ãªã‚«ãƒ¼ãƒ‰ã‚’çµã‚Šè¾¼ã¿
  const eligibleCards = allCards.filter(card => {
    const tier = cardValues[card.id]?.tier || 'D';
    return raritySystem.canAppearAtRarity(tier, rarity);
  });

  // 3. ãƒ©ãƒ³ãƒ€ãƒ ã«1æšé¸æŠ
  const card = eligibleCards[Math.floor(Math.random() * eligibleCards.length)];

  return { cardId: card.id, rarity, card };
}
```

---

## UIç”»é¢ä»•æ§˜

### ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ï¼ˆå¤‰æ›´ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Magic Spirit               â”‚
â”‚                                    â”‚
â”‚    æ‰€æŒG: 10,000G                  â”‚
â”‚                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚  å¯¾æˆ¦    â”‚  â”‚ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚ ã‚·ãƒ§ãƒƒãƒ— â”‚  â”‚ãƒ‡ãƒƒã‚­ç·¨é›† â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ç”»é¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† æˆ»ã‚‹     ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³    G: 10,000â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ãƒ•ã‚£ãƒ«ã‚¿: [å…¨å±æ€§â–¼] [å…¨ãƒ¬ã‚¢â–¼] [æ¤œç´¢]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”       â”‚
â”‚ â”‚ã‚«ãƒ¼ãƒ‰â”‚ â”‚ã‚«ãƒ¼ãƒ‰â”‚ â”‚ã‚«ãƒ¼ãƒ‰â”‚ â”‚ã‚«ãƒ¼ãƒ‰â”‚  â”‚
â”‚ â”‚ CÃ—3 â”‚ â”‚SRÃ—1â”‚ â”‚ RÃ—2 â”‚ â”‚UCÃ—5â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜       â”‚
â”‚ â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”       â”‚
â”‚ â”‚    â”‚ â”‚    â”‚ â”‚    â”‚ â”‚    â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜       â”‚
â”‚                                    â”‚
â”‚ æ‰€æŒ: 156ç¨® / 433ç¨®  ç·æšæ•°: 312æš  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚·ãƒ§ãƒƒãƒ—ç”»é¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† æˆ»ã‚‹      ã‚·ãƒ§ãƒƒãƒ—       G: 10,000â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚    ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ‘ãƒƒã‚¯ â”‚          â”‚
â”‚   â”‚                     â”‚          â”‚
â”‚   â”‚    ğŸ´ 5æšå…¥ã‚Š        â”‚          â”‚
â”‚   â”‚    3,500G           â”‚          â”‚
â”‚   â”‚                     â”‚          â”‚
â”‚   â”‚   [ è³¼å…¥ã™ã‚‹ ]       â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                    â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚   ã‚«ãƒ¼ãƒ‰å£²å´ â†’                      â”‚
â”‚   ï¼ˆã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰é¸æŠï¼‰            â”‚
â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¯¾æˆ¦çµ‚äº†ç”»é¢ï¼ˆå¤‰æ›´ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    â”‚
â”‚            VICTORY!                â”‚
â”‚                                    â”‚
â”‚   â”€â”€â”€â”€â”€ å ±é…¬ â”€â”€â”€â”€â”€                  â”‚
â”‚                                    â”‚
â”‚   ğŸ’° 5,000G                        â”‚
â”‚   ğŸ´ ãƒ‘ãƒƒã‚¯ Ã—1ï¼ˆå‹åˆ©ãƒœãƒ¼ãƒŠã‚¹ï¼‰       â”‚
â”‚                                    â”‚
â”‚   [ ãƒ‘ãƒƒã‚¯ã‚’é–‹ã‘ã‚‹ ]                â”‚
â”‚   [ ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹ ]                â”‚
â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ‡ãƒƒã‚­ã¨ã®é€£æº

### ä»•æ§˜

1. ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ‡ãƒƒã‚­ã¯**ã‚«ãƒ¼ãƒ‰ã‚’æ‰€æŒã—ã¦ã„ãªãã¦ã‚‚ä½¿ç”¨å¯èƒ½**
2. æ‰€æŒã—ã¦ã„ã‚‹ã‚«ãƒ¼ãƒ‰ã¯**æœ€é«˜ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã‚’è‡ªå‹•é©ç”¨**
3. å¯¾æˆ¦ä¸­ã®ã‚«ãƒ¼ãƒ‰èƒ½åŠ›ã¯**ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã«é–¢ä¿‚ãªãåŒä¸€**

### å®Ÿè£…

```javascript
// ãƒ‡ãƒƒã‚­é¸æŠæ™‚ã®ãƒ¬ã‚¢ãƒªãƒ†ã‚£è§£æ±º
function resolvePrebuiltDeckRarities(prebuiltDeck, playerData) {
  return prebuiltDeck.cards.map(cardId => {
    const rarity = collectionManager.getHighestRarity(playerData, cardId);
    return { cardId, rarity };
  });
}
```

---

## å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

### Phase 1: ãƒ‡ãƒ¼ã‚¿åŸºç›¤ âœ… å®Œäº†
- `src/collection/data/storage.js`
- `src/collection/data/playerData.js`
- `src/collection/data/constants.js`
- `src/collection/data/migration.js`
- `src/collection/index.js`

### Phase 2: ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ  âœ… å®Œäº†
- `src/collection/systems/valueCalculator.js`
- `src/collection/systems/raritySystem.js`
- `src/collection/systems/collectionManager.js`
- `src/collection/systems/currencyManager.js`
- `src/collection/systems/packSystem.js`
- `src/collection/systems/shopSystem.js`

### Phase 3: ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³UI âœ… å®Œäº†
- `src/collection/components/CollectionScreen.jsx`
- `src/collection/components/CardGrid.jsx`
- `src/collection/components/CardDetail.jsx`
- ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã¸ã®å°ç·šè¿½åŠ 

### Phase 4: ãƒ‘ãƒƒã‚¯ãƒ»ã‚·ãƒ§ãƒƒãƒ— âœ… å®Œäº†
- `src/collection/components/ShopScreen.jsx`
- `src/collection/components/PackOpening.jsx`

### Phase 5: ã‚²ãƒ¼ãƒ çµ±åˆ âœ… å®Œäº†
- å¯¾æˆ¦çµ‚äº†æ™‚ã®å ±é…¬ä»˜ä¸ï¼ˆG + å‹åˆ©ãƒ‘ãƒƒã‚¯ï¼‰
- ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã«ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³/ã‚·ãƒ§ãƒƒãƒ—/ãƒã‚¤ãƒ‡ãƒƒã‚­ãƒœã‚¿ãƒ³
- ãƒ‡ãƒƒã‚­ä¸€è¦§ç”»é¢ï¼ˆ`DeckList.jsx`ï¼‰- ä¿å­˜ãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- ãƒ‡ãƒƒã‚­æ§‹ç¯‰ç”»é¢ï¼ˆ`DeckBuilder.jsx`ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®localStorageæ°¸ç¶šåŒ–

---

## å°†æ¥ã®æ‹¡å¼µäºˆå®š

- ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ‡ãƒƒã‚­ã®ãƒ¬ã‚¢ãƒªãƒ†ã‚£è§£æ±ºï¼ˆæ‰€æŒã‚«ãƒ¼ãƒ‰ã«æœ€é«˜ãƒ¬ã‚¢ãƒªãƒ†ã‚£é©ç”¨ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆãƒ‡ãƒƒã‚­ã§ã®å¯¾æˆ¦
- å±æ€§åˆ¥ãƒ‘ãƒƒã‚¯
- æ–°ã‚«ãƒ¼ãƒ‰ãƒ‘ãƒƒã‚¯
- ãƒˆãƒ¬ãƒ¼ãƒ‰æ©Ÿèƒ½
- ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ
- å®Ÿç¸¾ã‚·ã‚¹ãƒ†ãƒ 
- src/game/ ã¸ã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆç§»å‹•

---

## æ›´æ–°å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ |
|------------|------|----------|
| 1.0 | 2025-11-28 | åˆç‰ˆä½œæˆ |
| 1.1 | 2025-11-28 | å…¨ãƒ•ã‚§ãƒ¼ã‚ºå®Ÿè£…å®Œäº†ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã‚’å®Ÿæ…‹ã«åˆã‚ã›ã¦æ›´æ–° |
| 1.2 | 2025-11-28 | DeckList.jsxè¿½åŠ ï¼ˆãƒ‡ãƒƒã‚­ä¸€è¦§ãƒ»ç·¨é›†ãƒ»å‰Šé™¤æ©Ÿèƒ½ï¼‰ |
